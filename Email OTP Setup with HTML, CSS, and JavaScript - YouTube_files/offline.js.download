(function(g){var window=this;'use strict';var ljx=function(u){var l=new g.wy("und",new g.Bg("Default","und",!0));l.captionTracks=u.captionTracks;return l},edd=function(u){return new g.Qb(function(l,e){var p=u.length,x=[];
if(p)for(var f=function(M,E){p--;x[M]=E;p==0&&l(x)},D=function(M){e(M)},X,m=0;m<u.length;m++)X=u[m],g.Ljv(X,g.Mx(f,m),D);
else l(x)})},Bw=function(u){this.Z=u},Zf=function(){Bw.apply(this,arguments)},plx=function(){Zf.apply(this,arguments)},xux=function(){Zf.apply(this,arguments)},fjx=function(){Zf.apply(this,arguments)},Dux=function(){Zf.apply(this,arguments)},Gqb=function(){Zf.apply(this,arguments)},Xlg=function(){Zf.apply(this,arguments)},muW=function(){Zf.apply(this,arguments)},$ux=function(){Bw.apply(this,arguments)},M7y=function(){Zf.apply(this,arguments)},E2b=function(){Zf.apply(this,arguments)},q9v=function(){Zf.apply(this,
arguments)},rtb=function(){Zf.apply(this,arguments)},duh=function(){Zf.apply(this,arguments)},S9N=function(){Zf.apply(this,arguments)},CVT=function(){Zf.apply(this,arguments)},skg=function(){Zf.apply(this,arguments)},V7d=function(){Zf.apply(this,arguments)},o23=function(){Zf.apply(this,arguments)},WFd=function(){Zf.apply(this,arguments)},FFx=function(){Zf.apply(this,arguments)},v2W=function(){Bw.apply(this,arguments)},ytx=function(){Zf.apply(this,arguments)},zdb=function(){Zf.apply(this,arguments)},
QkN=function(){Zf.apply(this,arguments)},wlb=function(){Zf.apply(this,arguments)},Jt3=function(){Zf.apply(this,arguments)},Hdh=function(){Zf.apply(this,arguments)},kqb=function(){Zf.apply(this,arguments)},ctT=function(){Zf.apply(this,arguments)},Odv=function(){Zf.apply(this,arguments)},jkx=function(){Bw.apply(this,arguments)},BPd=function(){Bw.apply(this,arguments)},ZdH=function(){Bw.apply(this,arguments)},LFx=function(){Zf.apply(this,arguments)},NPZ=function(){Zf.apply(this,arguments)},RdN=function(){Zf.apply(this,
arguments)},KFH=function(){Zf.apply(this,arguments)},Uux=function(){Zf.apply(this,arguments)},Y9d=function(){Zf.apply(this,arguments)},hdv=function(){Zf.apply(this,arguments)},bd3=function(){Zf.apply(this,arguments)},ajb=function(){Zf.apply(this,arguments)},g23=function(){Zf.apply(this,arguments)},Ij2=function(){Zf.apply(this,arguments)},t7d=function(){Zf.apply(this,arguments)},TPb=function(){Zf.apply(this,arguments)},n2g=function(){Zf.apply(this,arguments)},PVg=function(){Zf.apply(this,arguments)},
Atb=function(){Zf.apply(this,arguments)},uwb=function(){Zf.apply(this,arguments)},iDd=function(){Zf.apply(this,arguments)},lKH=function(){Zf.apply(this,arguments)},ey3=function(){Zf.apply(this,arguments)},pnh=function(){Zf.apply(this,arguments)},xJN=function(){Zf.apply(this,arguments)},fKx=function(){Zf.apply(this,arguments)},DJg=function(){Zf.apply(this,arguments)},GON=function(){Zf.apply(this,arguments)},XnW=function(){Zf.apply(this,arguments)},mJN=function(){Zf.apply(this,arguments)},$J2=function(){Zf.apply(this,
arguments)},MAb=function(){Zf.apply(this,arguments)},EAW=function(){Bw.apply(this,arguments)},qih=function(){Zf.apply(this,arguments)},riN=function(){Zf.apply(this,arguments)},dJb=function(){Zf.apply(this,arguments)},Six=function(){Zf.apply(this,arguments)},CDH=function(){Zf.apply(this,arguments)},sLN=function(){Zf.apply(this,arguments)},VAd=function(){Zf.apply(this,arguments)},oAy=function(){Zf.apply(this,arguments)},WMT=function(){Zf.apply(this,arguments)},FMg=function(){Zf.apply(this,arguments)},
vA3=function(){Zf.apply(this,arguments)},yiy=function(){Zf.apply(this,arguments)},zyv=function(){Zf.apply(this,arguments)},QL2=function(){Zf.apply(this,arguments)},wnZ=function(){Zf.apply(this,arguments)},JiT=function(){Zf.apply(this,arguments)},HDx=function(){Zf.apply(this,arguments)},kOx=function(){Zf.apply(this,arguments)},cib=function(){Zf.apply(this,arguments)},ODh=function(){Zf.apply(this,arguments)},jL3=function(){Zf.apply(this,arguments)},BiH=function(){Zf.apply(this,arguments)},ZDb=function(){Zf.apply(this,
arguments)},LMg=function(){Zf.apply(this,arguments)},Nid=function(){Zf.apply(this,arguments)},Ry2=function(){Zf.apply(this,arguments)},KMg=function(){Zf.apply(this,arguments)},UJx=function(){Zf.apply(this,arguments)},Yi3=function(){Zf.apply(this,arguments)},hy2=function(){Zf.apply(this,arguments)},bDW=function(){Zf.apply(this,arguments)},aKb=function(){Zf.apply(this,arguments)},gAx=function(){Zf.apply(this,arguments)},IKZ=function(){Zf.apply(this,arguments)},tAW=function(u){u=u.key||u.id;
if(!u)throw Error("Entity key is missing");return u},TiZ=function(){if(LH)return LH();
var u={};LH=g.gC("PersistentEntityStoreDb",{jT:(u.EntityStore={OU:1},u.EntityAssociationStore={OU:2},u),shared:!1,upgrade:function(l,e){e(1)&&g.wC(g.W3(l,"EntityStore",{keyPath:"key"}),"entityType","entityType");e(2)&&(l=g.W3(l,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.wC(l,"byParentEntityKey","parentEntityKey"),g.wC(l,"byChildEntityKey","childEntityKey"))},
version:3});return LH()},nAh=function(u){return g.Zh(TiZ(),u)},PDx=function(u){return g.Zh((0,g.Qwx)(),u)},Ns=function(u){this.token=u},Ro=function(u,l){l=l===void 0?{}:l;
g.UJ.call(this,g.wpv[u],Object.assign({},{name:"PESEncoderError",type:u},l));this.type=u;this.level="WARNING";Object.setPrototypeOf(this,Ro.prototype)},AiH=function(u){return new Ro("WRONG_DATA_TYPE",{D2:u})},u5y=function(u){return u instanceof Error?new Ro("UNKNOWN_ENCODE_ERROR",{originalMessage:u.message}):new Ro("UNKNOWN_ENCODE_ERROR")},ibb=function(u){return u instanceof Error?new Ro("UNKNOWN_DECODE_ERROR",{originalMessage:u.message}):new Ro("UNKNOWN_DECODE_ERROR")},liT=function(u,l){u=u instanceof
Ro?u:l(u);
g.yP(u);throw u;},eWg=function(){},pZg=function(u,l,e){try{return u.J(l,e)}catch(p){liT(p,u5y)}},xO2=function(u){u=(new TextEncoder).encode(u).subarray(0,16);
var l=new Uint8Array(16);l.set(u);return l},KH=function(u){this.Z=u},DOx=function(u){var l=fih[u];
if(l)return l;g.QP(new g.UJ("Entity model not found.",{entityType:u}))},GPb=function(u,l){this.Z=u;
this.j=l;this.J={}},mOy=function(u,l){a:{u=XZh(u.j,l.version);
try{var e=u.j(l.data,l.key);break a}catch(p){liT(p,ibb)}e=void 0}return e},UP=function(u,l,e){return u.Z.objectStore("EntityStore").get(l).then(function(p){if(p){if(e&&p.entityType!==e)throw Error("Incorrect entity type");
return mOy(u,p)}})},Yd=function(u,l,e){return e?(e=e.map(function(p){return UP(u,p,l)}),g.rC.all(e)):u.Z.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(function(p){return p.map(function(x){return mOy(u,x)})})},bg=function(u,l,e){var p=tAW(l),x=XZh(u.j,1),f=Object.assign({},l);
return u.Z.objectStore("EntityStore").get(p).then(function(D){if(D){if(D.entityType!==e)throw Error("Incorrect entity type");f.entityMetadata||(D=mOy(u,D),f.entityMetadata=D.entityMetadata)}}).then(function(){var D={key:p,
entityType:e,data:pZg(x,f,p),version:1};return g.rC.all([g.yi(u.Z.objectStore("EntityStore"),D),$OT(u,f,e)])}).then(function(){h_(u,p,e);
return p})},Mkb=function(u,l,e){l=l.map(function(p){return bg(u,p,e)});
return g.rC.all(l)},ao=function(u,l,e){if(e==null?0:e.FK){var p=new Set;
return Eox(u,l,p).then(function(){for(var f=[],D=g.F(p),X=D.next();!X.done;X=D.next())f.push(ao(u,X.value));return g.rC.all(f).then(function(){})})}var x=g.PD(l).entityType;
return g.rC.all([u.Z.objectStore("EntityStore").delete(l),q7N(u,l)]).then(function(){h_(u,l,x)})},rhb=function(u,l){return g.c3(u.Z.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},function(e){return g.rC.all([e.delete(),
q7N(u,e.cursor.primaryKey)]).then(function(){h_(u,e.cursor.primaryKey,l);return g.H3(e)})})},dO3=function(u,l,e,p){var x=XZh(u.j,1);
return UP(u,l,p).then(function(f){if(f){f=g.fA(f,e);var D={key:l,entityType:p,data:pZg(x,f,l),version:1};return g.rC.all([g.yi(u.Z.objectStore("EntityStore"),D),$OT(u,f,p)])}}).then(function(){h_(u,l,p);
return l})},h_=function(u,l,e){var p=u.J[e];
p||(p=new Set,u.J[e]=p);p.add(l)},S73=function(u,l,e){var p=tAW(l);
e=DOx(e);if(!e)return g.rC.resolve([]);e=new e(l);u=u.Z.objectStore("EntityAssociationStore");l=[];e=g.F(e.j());for(var x=e.next();!x.done;x=e.next())l.push(g.yi(u,{parentEntityKey:p,childEntityKey:x.value}));return g.rC.all(l).then(function(f){return f.map(function(D){return D[1]})})},q7N=function(u,l){return u.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},$OT=function(u,l,e){var p=tAW(l);
return q7N(u,p).then(function(){return S73(u,l,e)})},Eox=function(u,l,e){if(e.has(l))return g.rC.resolve(void 0);
e.add(l);return C0h(u,l).then(function(p){return u.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(function(){return p})}).then(function(p){var x=g.rC.resolve(void 0);
p=g.F(p);for(var f=p.next(),D={};!f.done;D={X4:void 0},f=p.next())D.X4=f.value,x=x.then(function(X){return function(){return Eox(u,X.X4,e)}}(D));
return x}).then(function(){})},C0h=function(u,l){var e=u.Z.objectStore("EntityAssociationStore");
return e.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(function(p){var x=[];p=g.F(p);for(var f=p.next();!f.done;f=p.next())f=f.value,x.push(e.index("byChildEntityKey").getAll(f.childEntityKey));return g.rC.all(x)}).then(function(p){var x=[];
p=g.F(p);for(var f=p.next();!f.done;f=p.next())f=f.value,f.length===1&&x.push(f[0].childEntityKey);return x})},gq=function(){},sqb=function(){this.Z={};
this.Z[0]=new gq;if(!g.C6("aes_pes_encoder_killswitch")){var u=this.Z;try{var l=g.YC();var e=xO2(l);var p=new KH(new g.El(e),new g.qt(e))}catch(x){throw u=x instanceof Error?new Ro("KEY_CREATION_FAILED",{originalMessage:x.message}):new Ro("KEY_CREATION_FAILED"),g.yP(u),u;}u[1]=p}},XZh=function(u,l){l=l===void 0?0:l;
u=u.Z[l];if(!u)throw l=new Ro("INVALID_ENCODER_VERSION",{D2:l}),g.yP(l),l;return u},Io=function(u,l){g.R.call(this);
this.token=u;this.Z=l;this.observers=[];u=new g.Pk.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.YC());u.onmessage=this.j.bind(this);this.channel=u},t_=function(u,l,e){var p,x,f,D;
return g.O(function(X){if(X.Z==1)return g.c(X,nAh(u.token),2);if(X.Z!=3)return p=X.j,g.c(X,g.v3(p,["EntityStore","EntityAssociationStore"],l,function(m){x=new GPb(m,u.Z);return e(x)}),3);
f=X.j;x&&(D=x.J,Object.keys(D).length>0&&(u.channel.postMessage(D),Vkg(u,D)));return X.return(f)})},TF=function(u,l,e){return t_(u,{mode:"readwrite",
yH:!0},function(p){return bg(p,l,e)})},ooh=function(u,l){return t_(u,{mode:"readwrite",
yH:!0},function(e){return Mkb(e,l,"offlineOrchestrationActionWrapperEntity")})},WAN=function(u,l){return t_(u,{mode:"readwrite",
yH:!0},function(e){return ao(e,l)})},FAg=function(u){return t_(u,{mode:"readwrite",
yH:!0},function(l){return rhb(l,"videoPlaybackPositionEntity")})},nH=function(u,l,e){return t_(u,{mode:"readonly",
yH:!0},function(p){return UP(p,l,e)})},Pw=function(u,l,e){return t_(u,{mode:"readonly",
yH:!0},function(p){return Yd(p,l,e)})},Vkg=function(u,l){u=g.F(u.observers);
for(var e=u.next();!e.done;e=u.next())e=e.value,e(l)},vo3=function(){var u,l,e;
return g.O(function(p){if(p.Z==1)return g.vk(p,2),g.c(p,g.bm(),4);if(p.Z!=2){u=p.j;if(!u||!g.h$()||typeof g.Pk.BroadcastChannel==="undefined")return p.return();l=new sqb;return p.return(new Io(u,l))}e=g.Hk(p);e instanceof Error&&g.yP(e);return p.return()})},A_=function(){yh2||(yh2=vo3());
return yh2},zWv=function(u){var l;
u=(l=u.options)==null?void 0:l.persistenceOption;return u==="ENTITY_PERSISTENCE_OPTION_PERSIST"||u==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Qqb=function(u){var l;
return g.O(function(e){return e.Z==1?g.c(e,A_(),2):(l=e.j)?g.c(e,t_(l,"readwrite",function(p){for(var x={},f=g.F(u),D=f.next(),X={};!D.done;X={St:void 0,GA:void 0},D=f.next())X.St=D.value,X.St.entityKey&&zWv(X.St)&&(X.GA=g.xq(X.St.payload),D=void 0,X.St.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(D=function(m){return function(){return bg(p,m.St.payload[m.GA],m.GA)}}(X)),X.St.type==="ENTITY_MUTATION_TYPE_DELETE"&&(D=function(m){return function(){return ao(p,m.St.entityKey)}}(X)),X.St.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(D=function(m){return function(){return dO3(p,m.St.entityKey,m.St.payload[m.GA],m.GA)}}(X)),D&&(x[X.St.entityKey]=x[X.St.entityKey]?x[X.St.entityKey].then(D):D()));
return g.rC.all(Object.values(x))}),0):e.return()})},wZW=function(u){var l;
return g.O(function(e){if(e.Z==1){l=u.mutations;if(!l||l.length<=0)return e.return();if(g.kj){var p={type:"ENTITY_LOADED"};l!==void 0&&(p.payload=l);g.kj.dispatch(p)}return g.c(e,Qqb(l),2)}l.length=0;g.F1(e)})},JhH=function(u){return u!==void 0},Hbd=function(u){var l=g.f2();
l=Object.assign({},l);u=Object.assign({},u);for(var e in l)u[e]?(l[e]!==4&&(l[e]=u[e]),delete u[e]):l[e]!==2&&(l[e]=4);Object.assign(l,u);g.Pv1(l);JSON.stringify(l);return l},kPH=function(u){var l,e;
return g.O(function(p){if(p.Z==1)return g.c(p,g.bm(),2);if(p.Z!=3)return(l=p.j)?g.c(p,g.Xr(l),3):p.return();e=p.j;return p.return(g.v3(e,["index","media","captions"],{mode:"readwrite",yH:!0},function(x){var f=IDBKeyRange.bound(u+"|",u+"~");x=[x.objectStore("index").delete(f),x.objectStore("media").delete(f),x.objectStore("captions").delete(f)];return g.rC.all(x).then(function(){})}))})},ch2=function(){var u,l;
return g.O(function(e){if(e.Z==1)return g.c(e,g.bm(),2);if(e.Z!=3){u=e.j;if(!u)throw g.Eo("rvdfd");return g.c(e,g.Xr(u),3)}l=e.j;return e.return(g.v3(l,["index","media"],{mode:"readwrite",yH:!0},function(p){var x={};return g.JT(p.objectStore("index"),{},function(f){var D=f.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),X=g.rC.resolve(void 0);if(D){var m=D[1];D=D[2];x[m]=x[m]||{};var M;x[m][D]=g.e8m((M=f.getValue())==null?void 0:M.fmts)}else X=f.delete().then(function(){});
return g.rC.all([g.H3(f),X]).then(function(E){return g.F(E).next().value})}).then(function(){for(var f={},D=g.F(Object.keys(x)),X=D.next();!X.done;X=D.next()){X=X.value;
var m=x[X].v;f[X]=x[X].a&&m?1:2}var M=Hbd(f);return g.w5O(p.objectStore("media"),{},function(E){var q=E.cursor.key.match(g.DqP);q&&f[q[1]]||p.objectStore("media").delete(E.cursor.key);return g.sAl(E)}).then(function(){return M})})}))})},Obv=function(u,l){var e,p;
return g.O(function(x){if(x.Z==1)return g.c(x,g.bm(),2);if(x.Z!=3){e=x.j;if(!e)throw g.Eo("wct");return g.c(x,g.Xr(e),3)}p=x.j;return g.c(x,g.v3(p,["captions"],{mode:"readwrite",yH:!0},function(f){var D=[];f=f.objectStore("captions");for(var X=0;X<l.length;X++){var m=g.yi(f,l[X],u+"|"+l[X].metadata.vss_id);D.push(m)}return g.rC.all(D)}),0)})},jqT=function(u){var l,e,p;
return g.O(function(x){if(x.Z==1)return l=IDBKeyRange.bound(u+"|",u+"~"),g.c(x,g.bm(),2);if(x.Z!=3){e=x.j;if(!e)throw g.Eo("gactfv");return g.c(x,g.Xr(e),3)}p=x.j;return x.return(p.getAll("captions",l))})},B9N=function(u){return g.O(function(l){g.GA(u,0);
return l.return(kPH(u))})},Zbx=function(u){return{context:g.ni(),
videoIds:u}},LAT=function(u){return{context:g.ni(),
playlistIds:u}},N9W=function(u){return{context:g.ni(),
offlinePlaylistSyncChecks:u}},RWH=function(){this.Z=new Map},UO2=function(){KAx||(KAx=new RWH);
return KAx},Y7x=function(u,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:u},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},hWN=function(u,l,e){if(!e){var p=p===void 0?!1:p;
e=u.Z.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!e||p)e=g.Mv(16),u.Z.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",e)}u={flowNonce:e,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(u.flowMetadata=l.metadata);l.statusCode!==void 0&&(u.flowEventStatus=l.statusCode);l.csn&&(u.csn=l.csn);l.can&&(u.can=l.can);g.MC("flowEvent",u,void 0)},bbT=function(u){var l,e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq;
return g.O(function(zN){if(zN.Z==1)return g.c(zN,t_(u,{mode:"readonly",yH:!0},function(ev){return Yd(ev,"playbackData").then(function(Q3){var y=Q3.map(function(Ly){return Ly.transfer}).filter(function(Ly){return!!Ly}),lr=Q3.map(function(Ly){return Ly.offlineVideoPolicy}).filter(function(Ly){return!!Ly}),zm=Q3.filter(function(Ly){return!!Ly.key}).map(function(Ly){return g.Ac(g.PD(Ly.key).entityId,"downloadStatusEntity")});
y=Yd(ev,"transfer",y);lr=Yd(ev,"offlineVideoPolicy",lr);zm=Yd(ev,"downloadStatusEntity",zm);var n3=y.then(function(Ly){Ly=Ly.reduce(function(hK,ih){(ih==null?0:ih.offlineVideoStreams)&&hK.push.apply(hK,g.rj(ih.offlineVideoStreams));return hK},[]).filter(function(hK){return!!hK});
return Yd(ev,"offlineVideoStreams",Ly)});
return g.rC.all([y,lr,n3,zm]).then(function(Ly){var hK=g.F(Ly);Ly=hK.next().value;var ih=hK.next().value;var eS=hK.next().value;hK=hK.next().value;return[Q3,Ly,ih,eS,hK]})})}),2);
if(zN.Z!=3)return l=zN.j,g.c(zN,t_(u,{mode:"readonly",yH:!0},function(ev){return Yd(ev,"mainDownloadsListEntity").then(function(Q3){var y,lr;return(lr=(y=Q3[0])==null?void 0:y.downloads)!=null?lr:[]})}),3);
e=zN.j;p=g.F(l);x=p.next().value;f=p.next().value;D=p.next().value;X=p.next().value;m=p.next().value;M=x;E=f;q=D;r=X;d=m;S={};v={};z={};H={};J={};B=[];N=g.F(E);for(U=N.next();!U.done;U=N.next())(n=U.value)&&(S[n.key]=n);b=g.F(q);for(pm=b.next();!pm.done;pm=b.next())(mO=pm.value)&&(v[mO.key]=mO);xz=g.F(d);for(Em=xz.next();!Em.done;Em=xz.next())(ir=Em.value)&&(z[ir.key]=ir);oP=g.F(r);for(tK=oP.next();!tK.done;tK=oP.next())($Z=tK.value)&&(H[$Z.key]=$Z);md=g.F(e);for(RP=md.next();!RP.done;RP=md.next())ck=
RP.value,lE=void 0,J[(lE=ck.videoItem)!=null?lE:""]=!0,ck.videoItem&&(Ug=Og=void 0,Dc=(Ug=(Og=g.PD(ck.videoItem))==null?void 0:Og.entityId)!=null?Ug:"",B.push({externalVideoId:Dc}));k=M.filter(function(ev){if(!ev||!ev.key||!ev.offlineVideoPolicy)return!1;ev=g.PD(ev.key).entityId;ev=g.Ac(ev,"downloadStatusEntity");var Q3;return!(ev&&((Q3=z[ev])==null?void 0:Q3.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
kq=k.map(function(ev){var Q3=S[ev.transfer],y=[];if(Q3==null?0:Q3.offlineVideoStreams)for(var lr=g.F(Q3.offlineVideoStreams),zm=lr.next();!zm.done;zm=lr.next())(zm=H[zm.value])&&y.push(zm);lr=v[ev.offlineVideoPolicy];zm=J;var n3=ev==null?void 0:ev.playerResponseTimestamp,Ly=g.PD(lr.key).entityId;ev=g.Ac(Ly,"mainVideoEntity");if(lr.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var hK="OFFLINE_VIDEO_STATE_DISABLED";lr.expirationTimestamp&&Number(lr.expirationTimestamp)<Date.now()/1E3&&(hK="OFFLINE_VIDEO_STATE_EXPIRED")}else if(lr.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")hK="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Q3==null?void 0:Q3.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":hK="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":hK="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":hK="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":hK="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":hK="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":hK="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:hK="OFFLINE_VIDEO_STATE_UNKNOWN"}if(hK==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Q3==null?void 0:Q3.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":hK="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":hK="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":hK=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Ly={id:Ly,videoState:hK};if(Q3==null?0:Q3.cotn)Ly.cotn=Q3.cotn;if(Q3==null?0:Q3.maximumDownloadQuality)Ly.selectedVideoQuality=Q3==null?void 0:Q3.maximumDownloadQuality;if(Q3==null?0:Q3.lastProgressTimeMs)Ly.lastProgressTimeMs=Q3.lastProgressTimeMs;n3&&(Ly.playerResponseSavedTimeMs=String(Number(n3)*1E3));Q3=String;n3=0;y=g.F(y);for(hK=y.next();!hK.done;hK=y.next())if(hK=hK.value,hK.streamsProgress){hK=g.F(hK.streamsProgress);for(var ih=hK.next();!ih.done;ih=hK.next()){var eS=
void 0;n3+=Number((eS=ih.value.numBytesDownloaded)!=null?eS:0)}}Ly.downloadedBytes=Q3(n3);Ly.selectedOfflineMode=zm[ev]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";lr.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Ly.offlinePlaybackDisabledReason=lr.offlinePlaybackDisabledReason);return Ly});
return zN.return({offlineVideos:kq,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:B}}})})},aib=function(){this.locks=navigator.locks},gox=function(){try{var u=g.uh("ytglobal.locks_");
if(u)return u;var l;if(l=navigator){var e=navigator;l="locks"in e&&!!e.locks}if(l)return g.Pk.localStorage&&g.Pk.localStorage.getItem("noop"),u=new aib,g.AK("ytglobal.locks_",u),u}catch(p){}},uB=function(){},IiN=function(){},tkv=function(u){if(u.includes(":"))throw Error("Invalid user cache name: "+u);
return u+":"+g.YC("CacheStorage get")},T9g=function(){return g.O(function(u){if(iB!==void 0)return u.return(iB);
iB=new Promise(function(l){var e;return g.O(function(p){switch(p.Z){case 1:return g.vk(p,2),g.c(p,lB.open("test-only"),4);case 4:return g.c(p,lB.delete("test-only"),5);case 5:g.JK(p,3);break;case 2:if(e=g.Hk(p),e instanceof Error&&e.name==="SecurityError")return l(!1),p.return();case 3:l("caches"in window),g.F1(p)}})});
return u.return(iB)})},P0y=function(){return g.O(function(u){if(u.Z==1)return g.c(u,T9g(),2);
if(!u.j)return u.return(void 0);noH||(noH=new IiN);return u.return(noH)})},ea=function(u,l,e){g.QP(new g.UJ("Woffle: "+u,e?{cotn:e}:""));
l instanceof Error&&g.QP(l)},Ah3=function(u){var l;
return g.O(function(e){if(e.Z==1)return g.c(e,bbT(u),2);l=e.j;g.MC("offlineStateSnapshot",l);g.F1(e)})},pB=function(u){g.R.call(this);
var l=this;this.api=u;this.ji={uM7:function(){return l.Z},
TkJ:function(){return l.j}};
typeof g.Pk.BroadcastChannel!=="undefined"&&(this.Z=new g.Pk.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.YC()),this.Z.onmessage=this.J.bind(this),this.j=new g.Pk.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.YC()),this.j.onmessage=this.X.bind(this))},xG=function(u,l){u.api.Nj("onOfflineOperationFailure",l);
var e;(e=u.Z)==null||e.postMessage(l)},ulW=function(u,l,e){var p=this;
this.G=u;this.Y=l;this.visibility=e;this.K=this.C=this.B=this.J=this.Z=!1;this.X=new g.ty(function(){p.zV()});
this.ji={l5:function(){return p.j},
zV:function(){p.zV()},
PbM:function(){return p.X}};
this.visibility.subscribe("visibilitystatechange",function(){p.I$()})},iTh=function(u){if(!u.J&&!u.Z){var l=gox();
if(l){u.J=!0;var e=g.YC("OfflineLockManager");l.request("woffle_orchestration_leader:"+e,{},function(){var p,x;return g.O(function(f){switch(f.Z){case 1:return g.vk(f,2),u.j=new g.mA,u.Z=!0,u.J=!1,g.c(f,u.G(),4);case 4:return g.c(f,u.j.promise,5);case 5:g.JK(f,0);break;case 2:p=g.Hk(f),u.zV(),p instanceof Error&&(x=p,x.args=[{name:"WoLockManagerError",oA:p.name}],g.yP(x)),g.F1(f)}})})}}},l1Z=function(u){u.Z&&(u.K=!0,fB(u))},eZy=function(u,l){u.Z&&(u.B=l,fB(u))},p5g=function(u,l){u.Z&&(u.C=l,fB(u))},
fB=function(u){u.C&&u.B&&u.K&&u.visibility.isBackground()?g.Ts(u.X,6E4):u.X.stop()},DO=function(u){var l;
u.offlineDeleteReason=(l=u.offlineDeleteReason)!=null?l:"OFFLINE_DELETE_REASON_UNKNOWN";var e;u.offlineModeType=(e=u.offlineModeType)!=null?e:"OFFLINE_NOW";g.MC("offlineDeleteEvent",u)},Gc=function(u,l){var e=l.videoId;
var p=l.qO;l=l.offlineModeType;u.encryptedVideoId=e;u.cotn=p==null?void 0:p.cotn;u.offlineabilityFormatType=p==null?void 0:p.maximumDownloadQuality;var x;u.isRefresh=(x=p==null?void 0:p.isRefresh)!=null?x:!1;var f;u.softErrorCount=(f=p==null?void 0:p.transferRetryCount)!=null?f:0;u.offlineModeType=l!=null?l:"OFFLINE_NOW";(u.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&u.statusType==="UNKNOWN_STATUS_TYPE"||!u.transferStatusType&&!u.statusType)&&g.QP(Error("Woffle unknown transfer status"));
g.MC("offlineTransferStatusChanged",u)},xod=function(u){Gc({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},u)},f1d=function(u,l,e,p){p={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!p};l&&e&&(l=Math.floor(l/1024).toFixed(),e=Math.floor(e/1024).toFixed(),p.alreadyDownloadedKbytes=l,p.totalFetchedKbytes=l,p.totalContentKbytes=e);Gc(p,u)},DoZ=function(u){Gc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},u)},Gsb=function(u){Gc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},u)},X5x=function(u){switch(u){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Xq=function(u){var l,e,p;
return((p=(l=u.actionMetadata)==null?void 0:(e=l.retryScheduleIntervalsInSeconds)==null?void 0:e.length)!=null?p:0)>0},mR=function(u){return u.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!u.entityKey},$G=function(u){return u.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!u.entityKey},M1=function(u){return u.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!u.entityKey},moW=function(u){return u.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!u.entityKey},
E6=function(u,l,e,p,x){x=x===void 0?!1:x;
var f,D,X,m,M,E;return g.O(function(q){if(q.Z==1)return f=g.Ac(u,l),D=g.Ac(u,"downloadStatusEntity"),g.c(q,t_(e,{mode:"readonly",yH:!0},function(r){return g.rC.all([UP(r,f,l),UP(r,D,"downloadStatusEntity")])}),2);
X=q.j;m=X.length?X[0]:void 0;if(!m)return q.Ke(0);M=$oy;if(E=X.length>1?X[1]:void 0){if(E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!x)return q.return();E.downloadState=p}else E={key:D,downloadState:p};g.cx(m,M,E);return g.c(q,t_(e,{mode:"readwrite",yH:!0},function(r){return g.rC.all([bg(r,m,l),bg(r,E,"downloadStatusEntity")])}),0)})},q1=function(u,l){return u.actionType===l.actionType&&u.entityKey===l.entityKey},r7=function(u,l){if(u&&u.transferState!=="TRANSFER_STATE_COMPLETE"&&u.transferState!==
"TRANSFER_STATE_FAILED"){var e=g.PD(u.key).entityId;
Gc({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:e,qO:u,offlineModeType:l})}},d7=function(u){if(!u||!u.thumbnails)return[];
var l=[];u=g.F(u.thumbnails);for(var e=u.next();!e.done;e=u.next())e=e.value,e.url&&l.push(e.url);return l},M0v=function(u,l,e){e=e===void 0?[]:e;
var p,x,f,D,X,m,M,E,q,r,d,S,v;return g.O(function(z){if(z.Z==1)return e.length?g.c(z,Pw(u,l),2):z.return([]);p=z.j;x=new Set;f=g.F(p);for(D=f.next();!D.done;D=f.next())if(X=D.value,m=X.id||X.key)M=g.PD(m).entityId,x.add(M);E=[];q=g.F(e);for(r=q.next();!r.done;r=q.next())d=r.value,S=d.offlineVideoData,v=void 0,((v=S)==null?0:v.videoId)&&!x.has(S.videoId)&&E.push(d);return z.return(E)})},E3y=function(u,l,e){return new g.WA(u,{cotn:l,
raw_player_response:e,download_media:!0,start:Infinity,disable_watch_next:!0})},qB2=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Sa=function(u,l,e,p,x,f,D,X,m,M,E){this.entityType=u;
this.actionId=l;this.action=e;this.parentActionId=p;this.rootActionId=x===void 0?l:x;this.childActionIds=f;this.prereqActionId=D;this.postreqActionIds=X;this.hasChildActionFailed=M;this.retryScheduleIndex=0;this.Z=E||Date.now();this.retryScheduleIndex=m||0},CB=function(u){if(!u.key)throw Error("Entity key is required.");
if(!u.actionProto)throw Error("OfflineOrchestrationAction is required.");var l=g.PD(u.key),e=g.PD(u.actionProto.entityKey);return new Sa(e.entityType,l.entityId,u.actionProto,u.parentActionId,u.rootActionId,u.childActionIds,u.prereqActionId,u.postreqActionIds,u.retryScheduleIndex,u.hasChildActionFailed,Number(u.enqueueTimeSec)*1E3)},s6=function(u){return{key:g.Ac(u.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:u.action,parentActionId:u.parentActionId,rootActionId:u.rootActionId,childActionIds:u.childActionIds,prereqActionId:u.prereqActionId,postreqActionIds:u.postreqActionIds,retryScheduleIndex:u.retryScheduleIndex,hasChildActionFailed:u.hasChildActionFailed,enqueueTimeSec:(u.Z/1E3).toFixed()}},ryW=function(){var u;
return g.O(function(l){return l.Z==1?g.c(l,P0y(),2):(u=l.j)?l.return(u.delete("yt-player-local-img")):l.return(!0)})},Vs=function(u){var l,e;
return g.O(function(p){if(p.Z==1)return g.c(p,P0y(),2);if(p.Z!=3){l=p.j;if(!l)throw Error("Cache API not supported");return u.length?g.c(p,l.open("yt-player-local-img"),3):p.return()}e=p.j;return g.c(p,Promise.all(u.map(function(x){return e.delete(x)})),0)})},oS=function(u){var l,e;
return g.O(function(p){if(p.Z==1)return g.c(p,P0y(),2);if(p.Z!=3){l=p.j;if(!l)throw Error("Cache API not supported");return u.length?g.c(p,l.open("yt-player-local-img"),3):p.return()}e=p.j;return g.c(p,e.addAll(u),0)})},W$=function(u,l,e,p,x){var f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE;
return g.O(function(Og){switch(Og.Z){case 1:return f=g.Ac(u,"mainVideoEntity"),D=g.Ac(u,"ytMainChannelEntity"),X=g.Ac(u,"transfer"),m=g.Ac(u,"videoDownloadContextEntity"),g.c(Og,t_(l,{mode:"readonly",yH:!0},function(Ug){return g.rC.all([UP(Ug,f,"mainVideoEntity"),UP(Ug,D,"ytMainChannelEntity"),UP(Ug,X,"transfer"),UP(Ug,m,"videoDownloadContextEntity"),Yd(Ug,"ytMainChannelEntity"),Yd(Ug,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:M=Og.j;E=g.F(M);q=E.next().value;r=E.next().value;d=E.next().value;S=E.next().value;v=E.next().value;z=E.next().value;H=q;J=r;B=d;N=S;U=v;n=z;if(!H&&!J){Og.Ke(3);break}b=H?d7(H.thumbnail):[];if(!J){pm=[];Og.Ke(4);break}return g.c(Og,doN(J,U),5);case 5:pm=Og.j;case 4:return mO=pm,g.c(Og,Vs(b.concat(mO)),3);case 3:xz=[];Em=g.Ac(u,"downloadStatusEntity");ir=g.F(n);for(oP=ir.next();!oP.done;oP=ir.next())tK=oP.value,$Z=g.PD(tK.key).entityId,md=CB(tK),RP=g.PD(md.action.entityKey).entityId,$Z!==u&&
RP!==u||q1(e,tK.actionProto)||xz.push(tK.key);return g.c(Og,t_(l,{mode:"readwrite",yH:!0},function(Ug){var Dc=xz.map(function(k){return ao(Ug,k)});
Dc.push(ao(Ug,f,{FK:!0}));Dc.push(ao(Ug,Em,{FK:!0}));return g.rC.all(Dc)}),7);
case 7:lE=(ck=N)==null?void 0:ck.offlineModeType,x&&(DO(x),x.offlineModeType&&(lE=x.offlineModeType)),r7(B,lE),xG(p,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.F1(Og)}})},sAv=function(u,l,e,p){var x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq,zN,ev,Q3,y,lr,zm,n3,Ly,hK,ih,eS,bE,Q;
return g.O(function(W){switch(W.Z){case 1:return x=g.Ac(u,"mainPlaylistEntity"),f=g.Ac(u,"ytMainChannelEntity"),g.c(W,t_(l,{mode:"readonly",yH:!0},function(w){return g.rC.all([UP(w,x,"mainPlaylistEntity"),UP(w,f,"ytMainChannelEntity"),Yd(w,"mainPlaylistEntity"),Yd(w,"mainDownloadsListEntity"),Yd(w,"ytMainChannelEntity"),Yd(w,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=W.j;X=g.F(D);m=X.next().value;M=X.next().value;E=X.next().value;q=X.next().value;r=X.next().value;d=X.next().value;S=m;v=M;z=E;H=q;J=r;B=d;if(!S&&!v){W.Ke(3);break}N=S?SBZ(S):[];if(!v){U=[];W.Ke(4);break}return g.c(W,doN(v,J),5);case 5:U=W.j;case 4:return n=U,g.c(W,Vs(N.concat(n)),3);case 3:b=[];pm=new Map;if(!S){W.Ke(7);break}return g.c(W,CPg(S,z,H),8);case 8:b=W.j;mO=g.F(b);for(xz=mO.next();!xz.done;xz=mO.next())Em=xz.value,pm.set(Em,{videoId:Em,playlistId:u,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.c(W,t_(l,{mode:"readonly",yH:!0},function(w){return g.rC.all([Yd(w,"transfer"),Yd(w,"videoDownloadContextEntity")])}),9);
case 9:ir=W.j;oP=g.F(ir);tK=oP.next().value;$Z=oP.next().value;md=tK;RP=$Z;ck=g.F(md);for(lE=ck.next();!lE.done;lE=ck.next())Og=lE.value,Ug=g.PD(Og.key).entityId,(Dc=pm.get(Ug))&&Og&&(Dc.cotn=Og.cotn);k=g.F(RP);for(kq=k.next();!kq.done;kq=k.next())zN=kq.value,ev=g.PD(zN.key).entityId,(Q3=pm.get(ev))&&zN&&(Q3.offlineModeType=zN.offlineModeType);case 7:y=[];lr=g.F(B);for(zm=lr.next();!zm.done;zm=lr.next())n3=zm.value,Ly=g.PD(n3.key).entityId,hK=CB(n3),Ly!==u&&hK.rootActionId!==u||q1(e,n3.actionProto)||
y.push(n3.key);ih=g.Ac(u,"mainPlaylistEntity");return g.c(W,t_(l,{mode:"readwrite",yH:!0},function(w){var Z=y.map(function(I){return ao(w,I)});
Z.push(ao(w,ih,{FK:!0}));return g.rC.all(Z)}),10);
case 10:if(!S){W.Ke(0);break}b.reverse();if(!b){W.Ke(0);break}eS=g.F(b);bE=eS.next();case 13:if(bE.done){W.Ke(0);break}Q=bE.value;return g.c(W,W$(Q,l,e,p,pm.get(Q)),14);case 14:bE=eS.next(),W.Ke(13)}})},o3N=function(u,l,e,p){var x,f,D,X,m,M,E,q,r;
return g.O(function(d){if(d.Z==1)return x=g.Ac("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map,g.c(d,t_(u,{mode:"readwrite",yH:!0},function(S){var v=Yd(S,"transfer"),z=Yd(S,"offlineOrchestrationActionWrapperEntity"),H=Yd(S,"videoDownloadContextEntity"),J=UP(S,x,"mainDownloadsListEntity");return g.rC.all([v,z,H,J]).then(function(B){B=g.F(B);var N=B.next().value;var U=B.next().value;var n=B.next().value;var b=B.next().value;B=V0b.map(function(mO){return rhb(S,mO)});
U=g.F(U);for(var pm=U.next();!pm.done;pm=U.next())pm=pm.value,q1(l,pm.actionProto)||B.push(ao(S,pm.key,{FK:!0}));b&&(b.downloads=[],B.push(bg(S,b,"mainDownloadsListEntity")));if(n)for(n=g.F(n),b=n.next();!b.done;b=n.next())b=b.value,U=g.PD(b.key).entityId,U=g.Ac(U,"transfer"),f.set(U,b.offlineModeType);return g.rC.all(B).then(function(){return N})})}),2);
D=d.j;X=g.F(D);for(m=X.next();!m.done;m=X.next())M=m.value,r7(M,f.get(M.key)),E=g.PD(M.key).entityId,q={videoId:E,offlineDeleteReason:p,cotn:M.cotn,offlineModeType:f.get(M.key)},DO(q),r=g.Ac(E,"mainVideoEntity"),xG(e,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(d,ryW(),0)})},SBZ=function(u,l){var e=[];
if(u.thumbnailStyleData){u=g.F(u.thumbnailStyleData);for(var p=u.next();!p.done;p=u.next()){var x=void 0,f=void 0,D=void 0;e=e.concat(d7((x=p.value)==null?void 0:(f=x.value)==null?void 0:(D=f.collageThumbnail)==null?void 0:D.coverThumbnail))}}l=d7(l);return e.concat(l)},CPg=function(u,l,e){var p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO;
return g.O(function(xz){p=[];x=new Set;if(e.length)for(f=g.F(e),D=f.next();!D.done;D=f.next())if(X=D.value,m=void 0,(m=X.downloads)==null?0:m.length)for(M=g.F(X.downloads),E=M.next();!E.done;E=M.next())q=E.value,q.videoItem&&(r=g.PD(q.videoItem).entityId,x.add(r));if(u.videos){d=g.F(u.videos);for(S=d.next();!S.done;S=d.next())v=S.value,z=JSON.parse(g.PD(v).entityId),z.videoId&&!x.has(z.videoId)&&p.push(z.videoId);H=g.F(l);for(J=H.next();!J.done;J=H.next())if(B=J.value,B.key!==u.key&&(N=B.videos))for(U=
g.F(N),n=U.next();!n.done;n=U.next())b=n.value,pm=JSON.parse(g.PD(b).entityId),pm.videoId&&(mO=p.indexOf(pm.videoId),mO!==-1&&p.splice(mO,1))}return xz.return(p)})},doN=function(u,l){var e,p,x,f,D,X,m,M;
return g.O(function(E){e=d7(u.avatar);p=g.F(l);for(x=p.next();!x.done;x=p.next())if(f=x.value,f.id!==u.id)for(D=g.F(d7(f.avatar)),X=D.next();!X.done;X=D.next())m=X.value,M=e.indexOf(m),M!==-1&&e.splice(M,1);return E.return(e)})},WcH=function(u){var l;
return g.O(function(e){l=g.Y(u.frameworkUpdates,Fq);return u.frameworkUpdates&&l?g.c(e,wZW(l),0):e.return()})},v32=function(u){var l;
if((l=u.onResponseReceivedActions)!=null&&l.length){var e;u=(e=g.Y(g.Y(u.onResponseReceivedActions[0],FcN),g.Wph))==null?void 0:e.actions;if(u!=null&&u.length)return u}},yyh=function(u){var l,e,p;
return g.O(function(x){if(x.Z==1)return u?g.c(x,nH(u,g.jj,"mainDownloadsListEntity"),2):x.return([]);l=x.j;return((e=l)==null?0:(p=e.downloads)==null?0:p.length)?x.return(l.downloads.map(function(f){var D;return(D=f.videoItem)!=null?D:""})):x.return([])})},QAb=function(u,l){var e;
return g.O(function(p){return p.Z==1?g.c(p,zZ3(u,l),2):(e=p.j)?g.c(p,t_(u,{mode:"readwrite",yH:!0},function(x){var f=[bg(x,e.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];e.mainDownloadsListEntity&&f.push(bg(x,e.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.rC.all(f)}),0):p.Ke(0)})},zZ3=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B;
return g.O(function(N){if(N.Z==1)return e=g.Ac("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.Ac("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(N,t_(u,{mode:"readonly",yH:!0},function(U){return g.rC.all([UP(U,e,"mainDownloadsLibraryEntity"),UP(U,p,"mainDownloadsListEntity")])}),2);
x=N.j;f=g.F(x);D=f.next().value;X=f.next().value;m=D;M=X;m||(m={id:e});E=g.F(l);for(q=E.next();!q.done;q=E.next())if(r=q.value,r===g.jj){if(m.smartDownloadsList)return N.return();m.smartDownloadsList=r}else if(d=g.PD(r).entityType,S={},d==="mainPlaylistEntity"?S.playlistItem=r:d==="mainVideoEntity"&&(S.videoItem=r),!g.EO(S)){v=void 0;if((v=M)==null?0:v.downloads){z=!1;H=g.F(M.downloads);for(J=H.next();!J.done;J=H.next())if(B=J.value,B.playlistItem===r||B.videoItem===r){z=!0;break}z||M.downloads.push(S)}else M=
{id:p,downloads:[S]};m.downloadsList=p}return N.return({mainDownloadsLibraryEntity:m,mainDownloadsListEntity:M})})},w5d=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z;
return g.O(function(H){if(H.Z==1)return e=g.Ac("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.Ac("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(H,t_(u,{mode:"readonly",yH:!0},function(J){return g.rC.all([UP(J,e,"mainDownloadsLibraryEntity"),UP(J,p,"mainDownloadsListEntity"),UP(J,g.jj,"mainDownloadsListEntity")])}),2);
x=H.j;f=g.F(x);D=f.next().value;X=f.next().value;m=f.next().value;M=D;E=X;q=m;if(!M)return H.Ke(0);if(l===g.jj&&((r=q)==null?0:r.downloads))q.downloads=[];else if((d=E)==null?0:d.downloads)for(S=g.PD(l).entityType,v=0;v<E.downloads.length;v++)if(z=E.downloads[v],S==="mainVideoEntity"&&z.videoItem===l){E.downloads.splice(v,1);break}else if(S==="mainPlaylistEntity"&&z.playlistItem===l){E.downloads.splice(v,1);break}return g.c(H,t_(u,{mode:"readwrite",yH:!0},function(J){var B=[bg(J,M,"mainDownloadsLibraryEntity")];
E&&B.push(bg(J,E,"mainDownloadsListEntity"));q&&B.push(bg(J,q,"mainDownloadsListEntity"));return g.rC.all(B)}),0)})},v$=function(u,l){var e,p,x,f,D,X,m,M,E,q,r;
return g.O(function(d){if(d.Z==1)return e=g.Ac(l,"transfer"),p=g.Ac(l,"videoDownloadContextEntity"),g.c(d,t_(u,{mode:"readonly",yH:!0},function(S){return g.rC.all([UP(S,e,"transfer"),UP(S,p,"videoDownloadContextEntity")])}),2);
x=d.j;f=g.F(x);D=f.next().value;X=f.next().value;m=D;M=X;r={videoId:l,cotn:(E=m)==null?void 0:E.cotn,offlineModeType:(q=M)==null?void 0:q.offlineModeType};return d.return(r)})},ys=function(u,l,e,p,x){var f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm;
return g.O(function(mO){switch(mO.Z){case 1:return f=g.Ac(u,"musicTrack"),D=g.Ac(u,"transfer"),g.c(mO,t_(l,{mode:"readonly",yH:!0},function(xz){return g.rC.all([UP(xz,f,"musicTrack"),UP(xz,D,"transfer"),Yd(xz,"musicTrack"),Yd(xz,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=mO.j;m=g.F(X);M=m.next().value;E=m.next().value;q=m.next().value;r=m.next().value;d=M;S=E;v=q;z=r;if(!d){mO.Ke(3);break}return g.c(mO,Jyx(d,v),4);case 4:return H=mO.j,g.c(mO,Vs(H),3);case 3:J=[];B=g.F(z);for(N=B.next();!N.done;N=B.next())U=N.value,n=g.PD(U.key).entityId,b=CB(U),pm=g.PD(b.action.entityKey).entityId,n!==u&&pm!==u||q1(e,U.actionProto)||J.push(U.key);return g.c(mO,t_(l,{mode:"readwrite",yH:!0},function(xz){var Em=J.map(function(ir){return ao(xz,ir)});
Em.push(ao(xz,f,{FK:!0}));return g.rC.all(Em)}),6);
case 6:r7(S),x&&DO(x),xG(p,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.F1(mO)}})},zc=function(u,l,e,p,x){var f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq;
return g.O(function(zN){switch(zN.Z){case 1:return f=g.Ac(u,l),D=g.Ac("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(zN,t_(e,{mode:"readonly",yH:!0},function(ev){return g.rC.all([UP(ev,f,l),UP(ev,D,"musicDownloadsLibraryEntity"),Yd(ev,l),Yd(ev,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=zN.j;m=g.F(X);M=m.next().value;E=m.next().value;q=m.next().value;r=m.next().value;d=M;S=E;v=q;z=r;if(!d){zN.Ke(3);break}return g.c(zN,Jyx(d,v),4);case 4:return H=zN.j,g.c(zN,Vs(H),3);case 3:J=[];B=new Map;if(!d){zN.Ke(6);break}return g.c(zN,HTT(d,v,S),7);case 7:J=zN.j;N=g.F(J);for(U=N.next();!U.done;U=N.next())n=U.value,b=g.PD(n).entityId,B.set(b,{videoId:b,playlistId:u,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.c(zN,Pw(e,"transfer"),8);case 8:for(pm=zN.j,mO=
g.F(pm),xz=mO.next();!xz.done;xz=mO.next())Em=xz.value,ir=g.PD(Em.key).entityId,(oP=B.get(ir))&&Em&&(oP.cotn=Em.cotn);case 6:tK=[];$Z=g.F(z);for(md=$Z.next();!md.done;md=$Z.next())RP=md.value,ck=g.PD(RP.key).entityId,lE=CB(RP),ck!==u&&lE.rootActionId!==u||q1(p,RP.actionProto)||tK.push(RP.key);Og=g.Ac(u,l);return g.c(zN,t_(e,{mode:"readwrite",yH:!0},function(ev){var Q3=tK.map(function(y){return ao(ev,y)});
Q3.push(ao(ev,Og,{FK:!0}));return g.rC.all(Q3)}),9);
case 9:if(!d){zN.Ke(0);break}J.reverse();if(!J.length){zN.Ke(0);break}Ug=g.F(J);Dc=Ug.next();case 12:if(Dc.done){zN.Ke(0);break}k=Dc.value;kq=g.PD(k).entityId;if(!kq){zN.Ke(13);break}return g.c(zN,ys(kq,e,p,x,B.get(kq)),13);case 13:Dc=Ug.next(),zN.Ke(12)}})},Qs=function(u,l,e){var p,x,f,D,X,m,M;
return g.O(function(E){if(E.Z==1)return g.c(E,t_(u,{mode:"readwrite",yH:!0},function(q){var r=Yd(q,"transfer"),d=Yd(q,"offlineOrchestrationActionWrapperEntity");return g.rC.all([r,d]).then(function(S){S=g.F(S);var v=S.next().value;var z=S.next().value;S=ksx.map(function(N){return rhb(q,N)});
z=g.F(z);for(var H=z.next();!H.done;H=z.next()){H=H.value;var J=g.PD(H.actionProto.entityKey).entityType==="musicTrack",B=H.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";q1(l,H.actionProto)||J&&(!J||B)||S.push(ao(q,H.key,{FK:!0}))}return g.rC.all(S).then(function(){return v})})}),2);
p=E.j;x=g.F(p);for(f=x.next();!f.done;f=x.next())D=f.value,r7(D),X=g.PD(D.key).entityId,m={videoId:X,offlineDeleteReason:void 0,cotn:D.cotn},DO(m),M=g.Ac(X,"musicTrack"),xG(e,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(E,ryW(),0)})},cyT=function(u){for(var l,e=g.F(u.additionalMetadatas),p=e.next();!p.done;p=e.next())p=p.value,p.offlineMusicVideoData&&(l=p.offlineMusicVideoData);
var x,f,D,X,m;return{id:g.Ac(u.videoId,"musicTrack"),videoId:u.videoId,title:u.title,thumbnailDetails:u.thumbnail,lengthMs:String(Number(u.lengthSeconds)*1E3),albumTitle:(x=l)==null?void 0:x.releaseTitle,musicVideoType:(f=l)==null?void 0:f.musicVideoType,contentRating:{explicitType:(D=l)==null?void 0:D.explicitType},artistNames:((X=l)==null?void 0:X.byline)||((m=l)==null?void 0:m.channelName),downloadMetadata:g.Ac(u.videoId,"musicTrackDownloadMetadataEntity")}},HTT=function(u,l,e){var p,x,f,D,X,m,
M,E,q,r,d,S,v,z,H,J,B,N;
return g.O(function(U){p=[];x=new Set;if((f=e)==null?0:(D=f.downloadedTracks)==null?0:D.length)for(X=g.F(e.downloadedTracks),m=X.next();!m.done;m=X.next())M=m.value,x.add(M);if(u.tracks){E=g.F(u.tracks);for(q=E.next();!q.done;q=E.next())r=q.value,x.has(r)||p.push(r);d=g.F(l);for(S=d.next();!S.done;S=d.next())if(v=S.value,v.id!==u.id&&(z=v.tracks))for(H=g.F(z),J=H.next();!J.done;J=H.next())B=J.value,N=p.indexOf(B),N!==-1&&p.splice(N,1)}return U.return(p)})},Jyx=function(u,l){var e,p,x,f,D,X,m,M;
return g.O(function(E){e=d7(u.thumbnailDetails);p=g.F(l);for(x=p.next();!x.done;x=p.next())if(f=x.value,f.id!==u.id)for(D=g.F(d7(f.thumbnailDetails)),X=D.next();!X.done;X=D.next())m=X.value,M=e.indexOf(m),M!==-1&&e.splice(M,1);return E.return(e)})},OTN=function(u,l){var e,p,x,f,D,X,m,M,E;
return g.O(function(q){if(q.Z==1)return e=g.Ac("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(q,nH(u,e,"musicDownloadsLibraryEntity"),2);(p=q.j)||(p={id:e});x=g.PD(l).entityType;x==="musicTrack"?(f=p.downloadedTracks)!=null&&f.includes(l)||(p.downloadedTracks=((D=p.downloadedTracks)!=null?D:[]).concat(l)):x==="musicPlaylist"?(X=p.downloadedPlaylists)!=null&&X.includes(l)||(p.downloadedPlaylists=((m=p.downloadedPlaylists)!=null?m:[]).concat(l)):x!=="musicAlbumRelease"||(M=p.downloadedAlbumReleases)!=
null&&M.includes(l)||(p.downloadedAlbumReleases=((E=p.downloadedAlbumReleases)!=null?E:[]).concat(l));return g.c(q,TF(u,p,"musicDownloadsLibraryEntity"),0)})},jAd=function(u,l){var e,p,x,f,D,X,m;
return g.O(function(M){if(M.Z==1)return e=g.Ac("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(M,nH(u,e,"musicDownloadsLibraryEntity"),2);p=M.j;if(!p)return M.Ke(0);x=g.PD(l).entityType;x==="musicTrack"?f=p.downloadedTracks:x==="musicPlaylist"&&(f=p.downloadedPlaylists);if((D=f)==null?0:D.length)for(X=0;X<f.length;X++)if(m=f[X],m===l){f.splice(X,1);break}return g.c(M,TF(u,p,"musicDownloadsLibraryEntity"),0)})},B8x=function(u){var l=u.videos;
u=[];var e=[];if(l){l=g.F(l);for(var p=l.next();!p.done;p=l.next()){var x=p.value.offlineVideoData.videoId;p=g.Ac(x,"musicTrack");x=g.Ac(x,"musicTrackDownloadMetadataEntity");u.push(p);e.push(x)}}return{Xa:u,JH:e}},w7=function(u,l,e){l={track:cyT(l)};
e&&(l.playlistId=e);if(u=g.Y(u.actionMetadata,ZTb))l.maximumDownloadQuality=u.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},N8T=function(u){var l,e,p,x,f,D,X,m;
return g.O(function(M){switch(M.Z){case 1:return l=g.tw(),e=Zbx(u),p=g.uU(Lcy),g.vk(M,2),f={vk:!0},g.c(M,g.ZJ(l,e,p,void 0,f),4);case 4:x=M.j;g.JK(M,3);break;case 2:D=g.Hk(M);if(D instanceof g.bU)throw X="GetOffline network manager error: "+D.message,ea(X,D),Error(X);ea("GetOffline fetch request error",D);throw Error("GetOffline fetch request error");case 3:m=JV(x);if(!x)throw ea("Network request failed"),Error("Network request failed");if(m!==void 0)H$(m);else if(!x.videos||!x.videos.length)throw ea("No data"),
Error("No data");return M.return(x.videos.map(function(E){return E.offlineVideoData}))}})},RZx=function(u){var l,e,p,x,f,D,X,m;
return g.O(function(M){switch(M.Z){case 1:return l=g.tw(),e=LAT(u),p=g.uU(Lcy),g.vk(M,2),f={vk:!0},g.c(M,g.ZJ(l,e,p,void 0,f),4);case 4:x=M.j;g.JK(M,3);break;case 2:D=g.Hk(M);if(D instanceof g.bU)throw X="GetOffline network manager error for playlist: "+D.message,ea(X,D),Error(X);ea("GetOffline fetch request error for playlist",D);throw Error("GetOffline fetch request error for playlist");case 3:m=JV(x);if(!x)throw ea("Network request failed for playlist"),Error("Network request failed for playlist");
if(m!==void 0)H$(m,"playlist");else if(!x.playlists||!x.playlists.length)throw ea("No data for playlist"),Error("No data for playlist");return M.return(x.playlists.map(function(E){return E.offlinePlaylistData}))}})},Uox=function(u,l,e,p){var x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP;
return g.O(function(ck){switch(ck.Z){case 1:return g.c(ck,A_(),2);case 2:x=ck.j;if(!x)return ck.return([]);f=[];if((D=p)==null?0:D.length){f=p;ck.Ke(3);break}return g.c(ck,Pw(x,"mainPlaylistEntity"),4);case 4:f=ck.j;case 3:if(!f.length)return ck.return([]);X=[];m=Date.now()/1E3;M=g.F(f);E=M.next();case 5:if(E.done)return X.length?g.c(ck,Kcx(X),10):ck.return([]);q=E.value;if(!q.downloadState){r=void 0;ck.Ke(8);break}return g.c(ck,nH(x,q.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:r=
ck.j;case 8:d=r;S=void 0;z=(v=(S=q)==null?void 0:S.entityMetadata)&&v.nextAutoRefreshIntervalSeconds?Number(v.nextAutoRefreshIntervalSeconds):NaN;H=Number.isNaN(z)?u:z;B=J=void 0;N=((J=d)==null?0:J.lastSyncedTimestampMillis)?Number((B=d)==null?void 0:B.lastSyncedTimestampMillis)/1E3:0;n=U=void 0;b=((U=d)==null?0:U.addedTimestampMillis)?Number((n=d)==null?void 0:n.addedTimestampMillis)/1E3:0;if(e||!v||N+H<=m){pm=[];mO=void 0;if((mO=q.videos)==null?0:mO.length)for(xz=g.F(q.videos),Em=xz.next();!Em.done;Em=
xz.next())ir=Em.value,oP=JSON.parse(g.PD(ir).entityId),oP.videoId&&pm.push(oP.videoId);tK="0";v&&($Z=void 0,tK=String(Number(($Z=v.offlineLastModifiedTimestampSeconds)!=null?$Z:0).toFixed()));md={playlistId:q.playlistId,videoIds:pm,offlineLastModifiedTimestamp:tK,autoSync:l,offlineDateAddedTimestamp:String(b.toFixed())};X.push(md)}E=M.next();ck.Ke(5);break;case 10:return RP=ck.j,ck.return(RP)}})},YBx=function(){var u,l,e,p,x;
return g.O(function(f){if(f.Z==1)return g.c(f,A_(),2);if(f.Z!=3)return(u=f.j)?g.c(f,Pw(u,"refresh"),3):f.return(!1);l=f.j;if((e=l[0])==null||!e.refreshTime)return f.return(!1);p=Number(l[0].refreshTime);x=Date.now()/1E3;return f.return(isFinite(p)&&x>=p)})},bTg=function(u,l){var e,p,x;
return g.O(function(f){switch(f.Z){case 1:return g.vk(f,2),g.c(f,hZH(u,l),4);case 4:return p=f.j,g.c(f,WcH(p),5);case 5:e=v32(p);g.JK(f,3);break;case 2:x=g.Hk(f),ea("getAndProcessSmartDownloadsResponse request or processing error",x);case 3:return f.return(e)}})},a1b=function(u,l,e,p){var x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP;
return g.O(function(ck){switch(ck.Z){case 1:return g.c(ck,A_(),2);case 2:x=ck.j;if(!x)return ck.return([]);f=[];if((D=p)==null?0:D.length){f=p;ck.Ke(3);break}return g.c(ck,Pw(x,"musicPlaylist"),4);case 4:f=ck.j;case 3:if(!f.length)return ck.return([]);X=[];m=Date.now()/1E3;M=g.F(f);E=M.next();case 5:if(E.done)return X.length?g.c(ck,Kcx(X),10):ck.return([]);q=E.value;r=void 0;S=(d=(r=q)==null?void 0:r.entityMetadata)&&d.nextAutoRefreshIntervalSeconds?Number(d.nextAutoRefreshIntervalSeconds):NaN;v=
Number.isNaN(S)?u:S;H=z=0;J="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!q.downloadMetadata){ck.Ke(8);break}return g.c(ck,nH(x,q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:B=ck.j,U=N=void 0,z=Number((U=(N=B)==null?void 0:N.addedTimestampMillis)!=null?U:"0")/1E3,b=n=void 0,H=Number((b=(n=B)==null?void 0:n.lastModifiedTimestampMillis)!=null?b:"0")/1E3,mO=pm=void 0,J=(mO=(pm=B)==null?void 0:pm.syncState)!=null?mO:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:xz=void 0;if(e||J!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!d||Number((xz=d.lastSyncedTimestampSeconds)!=null?xz:0)+v<=m){Em=[];ir=void 0;if((ir=q.tracks)==null?0:ir.length)for(oP=g.F(q.tracks),tK=oP.next();!tK.done;tK=oP.next())$Z=tK.value,Em.push(g.PD($Z).entityId);md={playlistId:q.playlistId,videoIds:Em,offlineLastModifiedTimestamp:String(H.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(z.toFixed())};X.push(md)}E=M.next();ck.Ke(5);break;case 10:return RP=ck.j,ck.return(RP)}})},hZH=function(u,l){var e,p,x,f,D,X,m,M,E,q;
return g.O(function(r){switch(r.Z){case 1:return e=g.tw(),g.c(r,A_(),2);case 2:p=r.j;if(!p){r.Ke(3);break}return g.c(r,bbT(p),4);case 4:x=r.j;case 3:var d=x;f={context:g.ni(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:u},offlineClientState:d,clientStateRequestData:{preferredFormatType:l}}}};D=g.uU(g3b);g.vk(r,5);m={vk:!0};return g.c(r,g.ZJ(e,f,D,void 0,m),7);case 7:X=r.j;g.JK(r,6);break;case 5:M=g.Hk(r);if(M instanceof g.bU)throw E=
"DPS network manager error for smart downloads: "+M.message,ea(E,M),Error(E);ea("DPS fetch request error for smart downloads",M);throw Error("DPS fetch request error for smart downloads");case 6:q=JV(X);if(X)q!==void 0&&H$(q,"smart downloads");else throw ea("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return r.return(X)}})},t0d=function(u,l){var e,p,x,f,D,X,m,M;
return g.O(function(E){switch(E.Z){case 1:return e=g.tw(),p={context:g.ni(),videoPlaybackPositionEntities:u,lastSyncTimestampUsec:l},x=g.uU(I12),g.vk(E,2),D={vk:!0},g.c(E,g.ZJ(e,p,x,void 0,D),4);case 4:f=E.j;g.JK(E,3);break;case 2:X=g.Hk(E);if(X instanceof g.bU)throw m="VPPS network manager error: "+X.message,ea(m,X),Error(m);ea("VPPS fetch request error",X);throw Error("VPPS fetch request error");case 3:M=JV(f);if(f)M!==void 0&&H$(M,"position sync");else throw ea("Network request failed for position sync"),
Error("Network request failed for position sync");return E.return(f)}})},n3Z=function(u,l,e){var p,x,f,D,X,m,M,E;
return g.O(function(q){switch(q.Z){case 1:p=g.tw();var r=e.refreshData,d=e.isEnqueuedForExpiredStreamUrlRefetch,S=e.HZ,v=e.offlineSourceData,z=e.mediaCapabilities,H={entityKey:u};r&&(H.refreshData=r);d&&(H.isExpiredStreamUrlRefetch=d);S&&(H.downloadParameters=S);v&&(H.offlineSourceData=v);r={context:g.wb(l),signatureTimestamp:20348,videos:[H]};z&&(r.mediaCapabilities=z);x=r;f=g.uU(T8x);g.vk(q,2);X={vk:!0};return g.c(q,g.ZJ(p,x,f,void 0,X),4);case 4:D=q.j;g.JK(q,3);break;case 2:m=g.Hk(q);if(m instanceof
g.bU)throw M="GetPDE network manager error: "+m.message,ea(M,m),Error(M);ea("GetPDE fetch request error",m);throw Error("GetPDE fetch request error");case 3:E=JV(D);if(D)E!==void 0&&H$(E,"PDE");else throw ea("Network request failed for PDE"),Error("Network request failed for PDE");return q.return(D)}})},JV=function(u){var l;
return(l=u.errorMetadata)==null?void 0:l.status},H$=function(u,l){l=l?" for "+l:"";
if(u===0)throw u="Empty response body"+l,ea(u),Error(u);u="Response with error"+l;ea(u);throw Error(u);},Kcx=function(u){var l,e,p,x,f,D,X,m;
return g.O(function(M){switch(M.Z){case 1:return l=g.tw(),e=N9W(u),p=g.uU(PPv),g.vk(M,2),f={vk:!0},g.c(M,g.ZJ(l,e,p,void 0,f),4);case 4:x=M.j;g.JK(M,3);break;case 2:D=g.Hk(M);if(D instanceof g.bU)throw X="offlinePlaylistSyncCheck network manager error: "+D.message,ea(X,D),Error(X);ea("offlinePlaylistSyncCheck fetch request error",D);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:m=JV(x);if(!x)throw ea("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(m!==void 0)H$(m,"playlist sync");else if(!x.offlinePlaylistSyncCheckDatas||!x.offlinePlaylistSyncCheckDatas.length)throw ea("No data for playlist sync"),Error("No data for playlist sync");return M.return(x.offlinePlaylistSyncCheckDatas.map(function(E){return E.offlinePlaylistSyncCheckData}))}})},kG=function(u){this.Z=u},AyT=function(u,l){var e,p,x,f,D,X;
return g.O(function(m){switch(m.Z){case 1:e=new Map,p=g.F(l),x=p.next();case 2:if(x.done){m.Ke(4);break}f=x.value;D=e;X=D.set;return g.c(m,u.j(f),5);case 5:X.call(D,f,m.j);x=p.next();m.Ke(2);break;case 4:return m.return(e)}})},c$=function(u,l,e,p,x,f){l=g.Ac(l,e);
p=Object.assign({},f,{priority:p,retryScheduleIntervalsInSeconds:x});return{actionType:u,entityKey:l,actionMetadata:p}},O6=function(u,l,e,p,x,f){this.status=u;
this.Z=l;this.X=e;this.j=p;this.J=x;this.downloadState=f},uuN=function(u,l,e){this.Z=u;
this.Qo=l;this.J=e},euZ=function(u,l){var e,p,x,f,D,X,m,M,E;
return g.O(function(q){switch(q.Z){case 1:return e=l.entityKey,x=(p=g.Y(l.actionMetadata,B$))==null?void 0:p.isEnqueuedForExpiredStreamUrlRefetch,g.vk(q,2),f=void 0,g.c(q,iKb(u,l),4);case 4:f=q.j;g.vk(q,5);var r=(r=g.Y(l.actionMetadata,B$))?{maximumDownloadQuality:r.maximumDownloadQuality}:void 0;return g.c(q,n3Z(e,u.Qo,{isEnqueuedForExpiredStreamUrlRefetch:x,HZ:r,offlineSourceData:f}),7);case 7:D=q.j;g.JK(q,6,2);break;case 5:return g.Hk(q,2),X=Xq(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ea("PDE handleAdd error"),q.return(ZO(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",X,"DOWNLOAD_STATE_FAILED"));case 6:return g.c(q,lMb(u,D,l),8);case 8:return q.return(ZO(l,!0,D.orchestrationActions));case 2:return m=g.Hk(q),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.GV&&m.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ea("PDE handleAdd error"),q.return(ZO(l,!1,void 0,M,E,"DOWNLOAD_STATE_FAILED"))}})},fMv=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO;
return g.O(function(xz){switch(xz.Z){case 1:return e=l.entityKey,p=g.PD(e).entityId,g.c(xz,t_(u.Z,{mode:"readonly",yH:!0},function(Em){var ir=UP(Em,e,"playbackData"),oP=UP(Em,g.Ac(p,"offlineVideoPolicy"),"offlineVideoPolicy");Em=UP(Em,g.Ac(p,"transfer"),"transfer");return g.rC.all([ir,oP,Em])}),2);
case 2:x=xz.j;f=g.F(x);D=f.next().value;X=f.next().value;m=f.next().value;M=D;E=X;q=m;if(!M||!E)return xz.return(ZO(l,!0));r=[];v=((S=M)==null?0:S.playerResponseJson)?JSON.parse(M.playerResponseJson):null;if(!(q&&v&&u.Qo.W("html5_refresh_deprecated_downloads"))){xz.Ke(3);break}d=psH(u,v,q);return g.c(xz,xj3(u,q),4);case 4:r=xz.j;case 3:z={lastPlayerResponseTimestampSeconds:M.playerResponseTimestamp,offlineToken:E.offlineToken,formatIds:r};H={};if((J=q)==null?0:J.maximumDownloadQuality)H.maximumDownloadQuality=
q.maximumDownloadQuality;g.vk(xz,5);B=void 0;return g.c(xz,iKb(u,l),7);case 7:return B=xz.j,g.vk(xz,8),g.c(xz,n3Z(e,u.Qo,{refreshData:z,HZ:H,offlineSourceData:B,mediaCapabilities:d}),10);case 10:N=xz.j;g.JK(xz,9,5);break;case 8:return g.Hk(xz,5),U=Xq(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ea("PDE handleRefresh error"),xz.return(ZO(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",U,
"DOWNLOAD_STATE_FAILED"));case 9:return g.c(xz,lMb(u,N,l),11);case 11:return xz.return(ZO(l,!0,N.orchestrationActions));case 5:return n=g.Hk(xz),b="PDE handleRefresh error",n instanceof Error&&(b="PDE handleRefresh error: "+n.message),pm="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mO="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.GV&&n.type==="QUOTA_EXCEEDED"&&(pm="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mO="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
ea(b),xz.return(ZO(l,!1,void 0,pm,mO,"DOWNLOAD_STATE_FAILED"))}})},iKb=function(u,l){var e,p,x,f;
return g.O(function(D){if(D.Z==1)return e=g.PD(l.entityKey).entityId,p=g.Ac(e,"videoDownloadContextEntity"),g.c(D,nH(u.Z,p,"videoDownloadContextEntity"),2);x=D.j;return(f=x)!=null&&f.offlineModeType?D.return({offlineModeType:x.offlineModeType}):D.return(void 0)})},lMb=function(u,l,e){var p,x,f,D,X;
return g.O(function(m){if(m.Z==1){if(!l.frameworkUpdates||!g.Y(l.frameworkUpdates,Fq))return m.return();if(!(g.Y(l.frameworkUpdates,Fq).mutations&&g.Y(l.frameworkUpdates,Fq).mutations.length>0&&g.Y(l.frameworkUpdates,Fq).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return m.Ke(2);p=g.PD(g.Y(l.frameworkUpdates,Fq).mutations[0].entityKey).entityId;return g.c(m,v$(u.Z,p),3)}if(m.Z!=2){x=m.j;f=g.Y(e.actionMetadata,B$);if(X=(D=f)==null?void 0:D.playlistId)x.playlistId=X;x.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.z1(u.Qo)?g.c(m,W$(p,u.Z,e,u.J,x),2):g.BJ(u.Qo)?g.c(m,ys(p,u.Z,e,u.J),2):m.Ke(2)}return g.c(m,wZW(g.Y(l.frameworkUpdates,Fq)),0)})},ZO=function(u,l,e,p,x,f){return new O6(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Xq(u),e,p,x,f)},psH=function(u,l,e){l=E3y(u.Qo,e.cotn,l);
e=g.Nl(l);return g.LkP(l,e,u.Qo)},xj3=function(u,l){var e,p,x,f,D,X,m,M,E,q,r;
return g.O(function(d){if(d.Z==1)return e=[],g.c(d,t_(u.Z,{mode:"readonly",yH:!0},function(S){var v=[],z=l.offlineVideoStreams;if(z){z=g.F(z);for(var H=z.next();!H.done;H=z.next())v.push(UP(S,H.value,"offlineVideoStreams"))}return g.rC.all(v)}),2);
if(p=d.j)for(x=g.F(p),f=x.next();!f.done;f=x.next())if(D=f.value,X=void 0,(X=D)==null?0:X.streamsProgress)for(m=D.streamsProgress,M=0;M<m.length;M++)E=m[M],q=JSON.parse(E.formatStreamBytes),r={itag:q.itag,lmt:q.lastModified,xtags:q.xtags},e.push(r);return d.return(e)})},DjZ=function(u,l){this.Z=u;
this.Qo=l},GQN=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d;
return g.O(function(S){switch(S.Z){case 1:return e=Xq(l),g.c(S,Pw(u.Z,"videoPlaybackPositionEntity"),2);case 2:p=S.j;if(p.length===0)return S.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.vk(S,3);return g.c(S,Ns.getInstance(),5);case 5:x=S.j;if(!x)throw Error("prefStorage is undefined");return g.c(S,x.get("psi"),6);case 6:return f=S.j,m=(X=(D=f)==null?void 0:D.IU)!=null?X:"0",g.c(S,t0d(p,m),7);case 7:return M=S.j,E={isPaused:M.watchHistoryPaused,IU:M.syncTimestampUsec},g.c(S,x.set("psi",
E),8);case 8:if(E.isPaused){S.Ke(9);break}q=g.Y(M.frameworkUpdates,Fq);if(!M.frameworkUpdates||!q){S.Ke(9);break}return g.c(S,wZW(q),9);case 9:g.JK(S,4);break;case 3:return r=g.Hk(S),d="PPE handleRefresh error: "+(r instanceof Error?r.message:"unknown error"),ea(d),S.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return S.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},mjy=function(u,l){var e,p,x,f,D,X,m,M;
return g.O(function(E){switch(E.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey).entityId,g.vk(E,2),g.c(E,Ns.getInstance(),4);case 4:x=E.j;if(!x)throw Error("prefStorage is undefined");return g.c(E,x.get("psi"),5);case 5:f=E.j;D=g.Y(l.actionMetadata,Xsx);if(((X=f)==null?void 0:X.isPaused)!==!1||(m=D)==null||!m.lastPlaybackPositionSeconds){E.Ke(6);break}M={key:g.Ac(p,"videoPlaybackPositionEntity"),videoId:p,lastPlaybackPositionSeconds:D.lastPlaybackPositionSeconds};return g.c(E,TF(u.Z,M,"videoPlaybackPositionEntity"),
6);case 6:g.JK(E,3);break;case 2:return g.Hk(E),E.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},$jT=function(u,l){var e,p,x;
return g.O(function(f){switch(f.Z){case 1:e=Xq(l);g.vk(f,2);p=g.PD(l.entityKey).entityId;if(p==="!*$_ALL_ENTITIES_!*$")return g.c(f,FAg(u.Z),5);x=g.Ac(p,"videoPlaybackPositionEntity");return g.c(f,WAN(u.Z,x),5);case 5:g.JK(f,3);break;case 2:return g.Hk(f),f.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},Mtv=function(u,l){this.api=u;
this.Z=l;this.logger=new g.FL("woffle");this.j=!1;this.ji={g2:this.g2}},EXx=function(u){return g.O(function(l){return l.return(B9N(u))})},q8W=function(u){var l;
return g.O(function(e){if(e.Z==1)return g.c(e,g.poB(u),2);l=e.j;return e.return(l.filter(function(p){return!!p.url}).map(function(p){return p.url}))})},LB=function(u,l){var e=g.Dq(l);
if(e===1||e===0)return Promise.resolve();(e=r8y(u,l))&&e.stopVideo();u.J=0;return EXx(l)},N1=function(u,l,e,p){e=e===void 0?!1:e;
p=p===void 0?!0:p;l=typeof l==="string"?l:l.videoDetails.videoId;if(g.Dq(l)===2){var x=r8y(u,l);x&&x.stopVideo();g.GA(l,2);u.J=2;e?djH(u.Z):p&&S8x(u.Z)}},r8y=function(u,l){var e;
return((e=u.player)==null?void 0:e.getVideoData().videoId)===l?u.player:null},C1T=function(u,l){this.Z=u;
this.Qo=l},Vtx=function(u,l){var e,p;
return g.O(function(x){switch(x.Z){case 1:return e=Xq(l),g.c(x,nH(u.Z,l.entityKey,"transfer"),2);case 2:if(p=x.j)return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.vk(x,3);return g.c(x,suW(u,l),5);case 5:g.JK(x,4);break;case 3:return g.Hk(x),x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},oXx=function(u,l){var e,p;
return g.O(function(x){switch(x.Z){case 1:return e=Xq(l),g.c(x,nH(u.Z,l.entityKey,"transfer"),2);case 2:p=x.j;if(!p||p.transferState!=="TRANSFER_STATE_COMPLETE")return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.vk(x,3);return g.c(x,suW(u,l,!0),5);case 5:g.JK(x,4);break;case 3:return g.Hk(x),x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},W_W=function(u,l){var e,p,x,f,D,X,m,M,E,q;
return g.O(function(r){switch(r.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey).entityId,g.c(r,t_(u.Z,{mode:"readonly",yH:!0},function(d){var S=UP(d,l.entityKey,"transfer");d=UP(d,g.Ac(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.rC.all([S,d])}),2);
case 2:x=r.j;f=g.F(x);D=f.next().value;X=f.next().value;m=D;M=X;if(!m||m.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return r.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.vk(r,3);m.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.c(r,TF(u.Z,m,"transfer"),5);case 5:E=g.PD(m.key).entityId;DoZ({videoId:E,qO:m,offlineModeType:(q=M)==null?void 0:q.offlineModeType});g.JK(r,4);break;case 3:return g.Hk(r),r.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return r.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},suW=function(u,l,e){e=e===void 0?!1:e;
var p,x,f,D,X,m,M,E,q,r,d,S,v,z,H;return g.O(function(J){switch(J.Z){case 1:return p=g.Y(l.actionMetadata,F_b),x=g.PD(l.entityKey).entityId,f=g.Ac(x,"downloadStatusEntity"),g.c(J,t_(u.Z,{mode:"readonly",yH:!0},function(B){var N=UP(B,f,"downloadStatusEntity");B=UP(B,g.Ac(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.rC.all([N,B])}),2);
case 2:return D=J.j,X=g.F(D),m=X.next().value,M=X.next().value,E=m,q=M,r="TRANSFER_STATE_TRANSFER_IN_QUEUE",((d=E)==null?void 0:d.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(r="TRANSFER_STATE_PAUSED_BY_USER"),z={key:l.entityKey,transferState:r,cotn:g.Mv(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(S=p)==null?void 0:S.maximumDownloadQuality,preferredAudioTrack:(v=p)==null?void 0:v.preferredAudioTrack,transferRetryCount:0,isRefresh:e,hasLoggedFirstStarted:!1},g.c(J,t_(u.Z,
{mode:"readwrite",yH:!0},function(B){var N=[];e&&N.push(ao(B,g.Ac(x,"offlineVideoStreams")));N.push(bg(B,z,"transfer"));return g.rC.all(N)}),3);
case 3:if(!e){J.Ke(4);break}return g.c(J,EXx(x),4);case 4:xod({videoId:x,qO:z,offlineModeType:(H=q)==null?void 0:H.offlineModeType}),g.F1(J)}})},y8g=function(u,l,e,p){if(!u.action.entityKey)throw Error("entityKey is missing.");
var x=g.PD(u.action.entityKey);x={entityType:x.un,entityId:x.entityId,offlineOrchestrationActionType:u.action.actionType,orchestrationAction:{orchestrationActionId:u.actionId}};l&&(x.offlineOrchestrationActionResult=l.status,x.isRetryable=e?!1:l.Z,l.J&&(x.offlineOrchestrationFailureReason=vX3(l.J,x.isRetryable)));var f,D;if((f=u.action.actionMetadata)==null?0:(D=f.offlineLoggingData)==null?0:D.offlineModeType)x.offlineModeType=u.action.actionMetadata.offlineLoggingData.offlineModeType;p&&(x.additionalOrchestrationActions=
p.map(function(X){return{orchestrationActionId:X.actionId}}));
return x},vX3=function(u,l){return u!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?u==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":u:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},zuh=function(u,l){var e={offlineOrchestrationContext:y8g(u)};
l=Y7x(l,e);hWN(UO2(),l,u.rootActionId)},Qu3=function(u,l,e,p){p=p===void 0?[]:p;
l={offlineOrchestrationContext:y8g(u,l,e,p)};l=Y7x(3,l);hWN(UO2(),l,u.rootActionId)},ws2=function(){this.actions=[]},J83=function(u,l){l=g.F(l);
for(var e=l.next();!e.done;e=l.next())e=e.value,zuh(e,1),u.actions.push(e);u.actions.sort(u.Z)},HK2=function(u,l){if(l)for(var e=0;e<u.actions.length;e++)if(l==="!*$_ALL_ENTITIES_!*$"&&u.actions[e].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&u.actions[e].rootActionId===l&&u.actions[e].actionId!==l)u.actions.splice(e,1),e--},kQg=function(u,l){u=g.F(u.actions);
for(var e=u.next();!e.done;e=u.next())if(e.value.actionId===l)return!0;return!1},RS=function(u,l,e,p,x){g.R.call(this);
var f=this;this.j=u;this.JZ=l;this.wD=e;this.C=p;this.Qo=x;this.Z=new ws2;this.B=new g.Z_;this.J=new g.ty(function(){f.retry()});
this.G=NaN;this.K=!1;this.ji={gUD:function(){return f.Z},
z3:function(){return f.B},
A0o:function(){return f.J},
retry:function(){return f.retry()}};
g.K(this,this.J);this.Y=this.j.observe(this.F9.bind(this))},jud=function(u,l,e,p,x){var f;
return g.O(function(D){if(D.Z==1)return f=new RS(u,l,e,p,x),g.c(D,c8d(f),2);OKy(f);return D.return(f)})},OKy=function(u){var l=u.Z.actions[0];
return u.X?((l==null?void 0:l.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&u.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(u.K=!0),Promise.resolve()):BJy(u)},BJy=function(u){var l,e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H;
return g.O(function(J){switch(J.Z){case 1:if(u.X)throw Error("Already processing an action");if(u.xg())return J.return();l=u.Z.actions.shift();eZy(u.wD,!l);if(l===void 0)return J.return();l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&HK2(u.Z,l.actionId);e="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(e=l.actionId);p=[l];u.X=p;if(x=u.JZ[l.entityType]){J.Ke(2);break}u.X=
void 0;return g.c(J,BJy(u),3);case 3:return J.return();case 2:f=g.F(p);for(D=f.next();!D.done;D=f.next())X=D.value,zuh(X,2);g.vk(J,4,5);return g.c(J,AyT(x,p.map(function(B){return B.action})),7);
case 7:m=J.j,M=g.F(p),E=M.next();case 8:if(E.done){J.Ke(10);break}q=E.value;r=m.get(q.action);return g.c(J,ZKT(u,q,r),9);case 9:E=M.next();J.Ke(8);break;case 10:HK2(u.Z,e);case 5:g.Om(J);u.X=void 0;g.jv(J,6);break;case 4:return d=g.Hk(J),ea("Orchestration error",d),g.vk(J,12),g.c(J,L_x(u,p),14);case 14:g.JK(J,5);break;case 12:S=g.Hk(J);ea("Orchestration retry error",S);v=g.F(p);for(z=v.next();!z.done;z=v.next())H=z.value,H.retryScheduleIndex<3&&J83(u.Z,[H]);J.Ke(5);break;case 6:return g.c(J,BJy(u),
0)}})},ZKT=function(u,l,e){var p,x,f,D,X,m,M,E,q,r,d,S;
return g.O(function(v){switch(v.Z){case 1:p=l.retryScheduleIndex+2===3;if(e.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){v.Ke(2);break}if(e.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){v.Ke(0);break}Qu3(l,e,p);if(e.Z&&l.retryScheduleIndex+1<3)return g.c(v,L_x(u,[l]),0);f=((x=e)==null?0:x.j)?e.j:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";D={entityKey:l.action.entityKey,failureReason:f};X=void 0;g.z1(u.Qo)?X="mainVideoDownloadStateEntity":g.BJ(u.Qo)&&(X="musicTrackDownloadMetadataEntity");
if(!X||!e.downloadState){v.Ke(7);break}m=g.PD(l.action.entityKey).entityId;return g.c(v,E6(m,X,u.j,e.downloadState),7);case 7:xG(u.C,D);if(e.downloadState==="DOWNLOAD_STATE_FAILED"&&u.Qo.W("html5_auto_retry_failed_pde_actions")){v.Ke(0);break}ea("Orchestration result is not retryable, deleting action");return g.c(v,WAN(u.j,s6(l).key),0);case 2:M=void 0;try{M=(E=e.X)==null?void 0:E.map(function(z){return u.createAction(z,l)})}catch(z){return Qu3(l,e,p),q={entityKey:l.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},xG(u.C,q),ea("Orchestration subactions creation error",z),v.return()}Qu3(l,e,p,M);if(!M){v.Ke(12);break}r=M.map(function(z){return s6(z)});
d=0;case 13:if(!(d<M.length)||u.K){v.Ke(15);break}return g.c(v,t_(u.j,{mode:"readwrite",yH:!0},function(z){var H=[];H.push(Mkb(z,r.slice(d,d+10),"offlineOrchestrationActionWrapperEntity"));return g.rC.all(H)}),16);
case 16:d+=10;v.Ke(13);break;case 15:if(u.K)return u.K=!1,v.return();case 12:return S=s6(l),g.c(v,WAN(u.j,S.key),17);case 17:zuh(l,4),g.F1(v)}})},Ujg=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d;
return g.O(function(S){e=[];p=Infinity;x=4E3;f=g.F(l);for(D=f.next();!D.done;D=f.next())X=D.value,m=Number(X.enqueueTimeSec),M=NJ2(m),E=X.retryScheduleIndex,q=E!=null&&E>0,M>0&&q?(p=Math.min(p,m),x=Math.min(M,x)):e.push(X);isFinite(p)&&(!u.J.isActive()||p<u.G)&&(u.G=p,u.J.start(x));u.B.OG()||(r=e.length,e=e.filter(function(v){var z;v=((z=v.actionProto)==null?void 0:z.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Ruy.includes(v)}),d=e.length<r,!u.J.isActive()&&d&&u.J.start(1));
e.length>0&&K_Z(u,e);return g.c(S,OKy(u),0)})},hug=function(u){var l,e,p,x,f,D,X;
return g.O(function(m){if(m.Z==1)return g.c(m,Y8Z(u),2);l=m.j;e=[];p=g.F(l);for(x=p.next();!x.done;x=p.next())f=x.value,D=g.PD(f.key),X=D.entityId,kQg(u.Z,X)||e.push(f);return g.c(m,Ujg(u,e),0)})},NJ2=function(u){u=u*1E3-Date.now();
return u>4E3?4E3:u},L_x=function(u,l){var e,p,x;
return g.O(function(f){e=g.F(l);for(p=e.next();!p.done;p=e.next()){x=p.value;var D=void 0,X=void 0,m=((X=x.action)==null?void 0:(D=X.actionMetadata)==null?void 0:D.retryScheduleIntervalsInSeconds)||[1,2,4];D=1;x.retryScheduleIndex<m.length&&(D=m[x.retryScheduleIndex]);x.Z=D*1E3+Date.now();x.retryScheduleIndex++}return g.c(f,bKT(u,l),0)})},c8d=function(u){var l;
return g.O(function(e){if(e.Z==1)return g.c(e,Pw(u.j,"offlineOrchestrationActionWrapperEntity"),2);l=e.j;return g.c(e,Ujg(u,l),0)})},K_Z=function(u,l){l.length!==0&&l.forEach(function(e){e=CB(e);
e.retryScheduleIndex<3&&J83(u.Z,[e])})},Y8Z=function(u,l){var e;
return g.O(function(p){if(p.Z==1)return g.c(p,Pw(u.j,"offlineOrchestrationActionWrapperEntity",l),2);e=p.j;return p.return(e.filter(JhH))})},bKT=function(u,l){if(l.length===0)return Promise.resolve([]);
l=l.map(function(e){return s6(e)});
return ooh(u.j,l)},aMb=function(u){this.eM=u;
this.Z=void 0},gXb=function(u,l){var e,p,x,f;
return g.O(function(D){e=l.videoId;p=!0;if(l.captionTracks.length)x=ljx(l),u.Z=new g.yf(u.eM,l,x);else if(l.V6)f=g.$yO(l),u.Z=new g.Qf(u.eM,l.V6,e,f,l.RX,l.eventId),p=l.RX;else return D.return();return D.return(new Promise(function(X){var m;(m=u.Z)==null||m.Xe({u9:function(){return g.O(function(M){if(M.Z==1)return g.c(M,u.u9(e,p),2);X();g.F1(M)})},
BX:function(){}})}))})},IMZ=function(u){var l;
return g.O(function(e){if(e.Z==1)return g.c(e,jqT(u),2);l=e.j;return e.return(!!l&&l.length>0)})},KB=function(u){g.R.call(this);
this.Z=u;this.j=this.Z.observe(this.J.bind(this))},ttg=function(u,l){var e,p,x,f,D,X,m;
return g.O(function(M){switch(M.Z){case 1:if(l.length===0)return M.return([]);e=l.map(function(E){return g.Ac(E,"transfer")});
return g.c(M,Pw(u.Z,"transfer",e),2);case 2:p=M.j;x=p.filter(JhH).map(function(E){return g.PD(E.key).entityId});
f=l.filter(function(E){return x.indexOf(E)===-1});
if(f.length===0)return M.return([]);D=g.F(f);X=D.next();case 3:if(X.done){M.Ke(5);break}m=X.value;return g.c(M,EXx(m),4);case 4:X=D.next();M.Ke(3);break;case 5:return M.return(f)}})},P1h=function(u,l,e,p,x,f){var D,X,m;
return g.O(function(M){D="STREAM_TYPE_UNKNOWN";e.video&&e.audio?(D="STREAM_TYPE_AUDIO_AND_VIDEO",ea("unexpected stream type")):e.video&&!e.audio?D="STREAM_TYPE_VIDEO":!e.video&&e.audio&&(D="STREAM_TYPE_AUDIO");X=g.Ac(l,"offlineVideoStreams");m={numBytesDownloaded:x.toFixed(),numTotalBytes:f.toFixed(),streamType:D,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(p),itag:D==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(e.itag):void 0};return g.c(M,t_(u,{mode:"readwrite",yH:!0},
function(E){var q=UP(E,X,"offlineVideoStreams"),r=UP(E,g.Ac(l,"transfer"),"transfer");return g.rC.all([q,r]).then(function(d){d=g.F(d);var S=d.next().value;d=d.next().value;if(!d)return ao(E,X).then(function(){});
var v=TJN(S);S=nXW(S,p,m,X);var z=bg(E,S,"offlineVideoStreams");TJN(S)>v&&(d.lastProgressTimeMs=Date.now().toString());v=[z];d.offlineVideoStreams||(d.offlineVideoStreams=[]);d.offlineVideoStreams.indexOf(X)===-1&&(d.offlineVideoStreams.push(X),v.push(bg(E,d,"transfer")));return g.rC.all(v)})}),0)})},A8b=function(u,l){var e,p,x,f,D;
return g.O(function(X){if(X.Z==1)return e=g.Ac(l,"offlineVideoStreams"),g.c(X,nH(u,e,"offlineVideoStreams"),2);p=X.j;if(!p||!p.streamsProgress)return X.return();x=g.F(p.streamsProgress);for(f=x.next();!f.done;f=x.next())D=f.value,D.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",D.numTotalBytes!==D.numBytesDownloaded&&(D.numBytesDownloaded=D.numTotalBytes);return g.c(X,TF(u,p,"offlineVideoStreams"),0)})},nXW=function(u,l,e,p){if(u&&u.streamsProgress){p=u;
a:{l=l.itag+";"+l.xtags;for(var x=u.streamsProgress,f=0;f<x.length;f++){var D=JSON.parse(x[f].formatStreamBytes);if(D.itag+";"+D.xtags===l){x[f]=e;e=x;break a}}x.push(e);e=x}p.streamsProgress=e}else u={key:p,streamsProgress:[e]};return u},TJN=function(u){if(u==null?0:u.streamsProgress){var l=0;
u=u.streamsProgress;for(var e=0;e<u.length;e++){var p=u[e];isNaN(Number(p.numBytesDownloaded))?ea("stream progress bytes number invalid"):l+=Number(p.numBytesDownloaded)}return l}return 0},ueW=function(u,l,e,p){g.R.call(this);
var x=this;this.j=u;this.api=l;this.v7=e;this.F9=p;this.B=new g.Z_;this.X=new g.ty(function(){x.Z&&x.Z.transferState==="TRANSFER_STATE_TRANSFERRING"&&x.B.OG()&&((x.Z.transferRetryCount||0)<3?N1(x.C,x.K,!1,!1):LB(x.C,x.K.videoDetails.videoId),x.Hw("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.wD=this.UJ=0;this.Y=this.G=!1;this.tZ=g.fe(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.OJ=new g.wt(this);this.ji={dwe:function(){return x.X},
iNp:function(){return x.F9},
z3:function(){return x.B}};
this.JZ=this.j.observe(this.Ph.bind(this));this.C=new Mtv(l,this);this.SM=new aMb(l);this.Rs=new KB(this.j);this.P7=this.B.listen("publicytnetworkstatus-online",this.jo.bind(this));this.AZ=this.B.listen("publicytnetworkstatus-offline",this.Jup.bind(this));this.Y=this.api.S().W("html5_less_transfer_processing_logs");g.K(this,this.OJ);this.OJ.L(l,"offlinetransferpause",this.XFe);if(g.z1(this.api.S()))this.J="mainVideoDownloadStateEntity";else if(g.BJ(this.api.S())||g.wB(this.api.S()))this.J="musicTrackDownloadMetadataEntity"},
i_N=function(u){return g.O(function(l){if(l.Z==1)l=g.c(l,ch2(),2);
else{var e=u.Rs;var p=g.f2();p=Object.keys(p);e=ttg(e,p);l=g.c(l,e,0)}return l})},YG=function(u,l){l=l===void 0?!1:l;
var e;return g.O(function(p){if(p.Z==1){if(u.Z)throw Error("Already downloading a video");u.wD=0;u.G=!1;return g.c(p,l0x(u),2)}return p.Z!=4?(e=p.j,p5g(u.v7,!e),e&&u.B.OG()?l?g.c(p,new Promise(function(x){g.Ee(x,1E3)}),4):p.Ke(4):(!e&&u.Z&&U6(u),p.Ke(0))):g.c(p,eCb(u,e),0)})},p0N=function(u){return g.O(function(l){if(l.Z==1)return u.K?g.c(l,LB(u.C,u.K.videoDetails.videoId),3):l.Ke(0);
U6(u);g.F1(l)})},xSb=function(u,l){var e,p,x;
return g.O(function(f){switch(f.Z){case 1:return g.vk(f,2),(e=!!l.captionTracks.length||!!l.V6)?g.c(f,IMZ(l.videoId),4):f.return();case 4:return(p=f.j)?f.return():g.c(f,gXb(u.SM,l),5);case 5:g.JK(f,0);break;case 2:x=g.Hk(f),ea("Caption downloading error",x,l.cotn),g.F1(f)}})},eCb=function(u,l){var e,p,x,f,D,X;
return g.O(function(m){switch(m.Z){case 1:if(u.G)return m.return();u.G=!0;u.Z=l;e=g.PD(u.Z.key);p=e.entityId;x=void 0;if(u.Z.transferState==="TRANSFER_STATE_TRANSFERRING")return g.c(m,hV(u,p),7);if(u.Z.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||u.Z.transferRetryCount||u.Z.hasLoggedFirstStarted){m.Ke(3);break}return g.c(m,hV(u,p),5);case 5:return x=m.j,u.Z.hasLoggedFirstStarted=!0,g.c(m,f0b(u),6);case 6:f1d({videoId:p,qO:u.Z,offlineModeType:x},void 0,void 0,!0);m.Ke(3);break;case 7:x=m.j,
Gc({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:p,qO:u.Z,offlineModeType:x});case 3:return g.c(m,DSx(u),8);case 8:return f=null,g.vk(m,9),g.c(m,Gng(u,l),11);case 11:f=m.j;u.K=f;g.JK(m,10);break;case 9:return D=g.Hk(m),ea("error getting player response",D,l.cotn),g.c(m,u.Hw("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return m.return();case 10:return X=E3y(u.api.S(),l.cotn,f),g.c(m,xSb(u,X),13);case 13:return g.c(m,q8W(X.videoId),
14);case 14:X.t0=m.j;var M=u.C,E=X,q=l.maximumDownloadQuality;E.getPlayerResponse();g.GA(E.videoId,2);M.J=2;M.j=!1;var r;(r=M.player)==null||r.dispose();M.player=M.api.Gt(E);E={};M.player.lf((E.localmediachange=M.h3,E.signatureexpired=M.u4,E.statechange=M.dLZ,E),M);M.W("html5_generate_content_po_token")&&M.player.xk();q=M.g2(q);M.player.Bq(g.Hm(q,q,!0,"m"),!1);M.player.CN(!1);u.X.start(108E5);g.F1(m)}})},l0x=function(u){var l,e;
return g.O(function(p){if(p.Z==1)return g.c(p,Pw(u.j,"transfer"),2);l=p.j;e=l.filter(X0y).sort(mSx);return e.length===0?p.return():p.return(e[0])})},DSx=function(u){var l,e,p;
return g.O(function(x){if(x.Z==1){if(!u.Z)return bB(u,"onTransferStart"),x.return();u.X.start(108E5);return g.c(x,aS(u,"TRANSFER_STATE_TRANSFERRING"),2)}l=u.Z;return(p=((e=l)==null?0:e.key)?g.PD(l.key).entityId:"")&&u.J?g.c(x,E6(p,u.J,u.j,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):x.Ke(0)})},djH=function(u){var l,e,p,x;
g.O(function(f){switch(f.Z){case 1:if(!u.Z){bB(u,"onTransferPausedByUser");f.Ke(2);break}l=u.Z;u.X.stop();return g.c(f,aS(u,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:p=((e=l)==null?0:e.key)?g.PD(l.key).entityId:"";if(!p||!u.J){f.Ke(4);break}return g.c(f,E6(p,u.J,u.j,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.c(f,hV(u,p),6);case 6:x=f.j,Gsb({videoId:p,qO:l,offlineModeType:x});case 2:U6(u),YG(u),g.F1(f)}})},S8x=function(u){var l,e,p;
g.O(function(x){if(x.Z==1){if(!u.Z)return bB(u,"onTransferPausedByNetwork"),x.return();u.X.stop();return g.c(x,aS(u,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(x.Z!=3)return l=u.Z,(p=((e=l)==null?0:e.key)?g.PD(l.key).entityId:"")&&u.J?g.c(x,E6(p,u.J,u.j,"DOWNLOAD_STATE_PAUSED"),3):x.Ke(3);U6(u);g.F1(x)})},$SW=function(u){var l,e,p,x,f;
g.O(function(D){switch(D.Z){case 1:if(!u.Z)return bB(u,"onTransferComplete"),D.return();l=u.Z;u.X.stop();if(!l||!u.K){D.Ke(2);break}e=E3y(u.api.S(),l.cotn,u.K);return g.c(D,xSb(u,e),2);case 2:return g.c(D,aS(u,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:x=((p=l)==null?0:p.key)?g.PD(l.key).entityId:"";if(!x||!u.J){D.Ke(5);break}return g.c(D,E6(x,u.J,u.j,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.c(D,A8b(u.j,x),7);case 7:return g.c(D,hV(u,x),8);case 8:f=D.j,Gc({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:x,qO:l,offlineModeType:f}),U6(u),YG(u),g.F1(D)}})},MFh=function(u,l,e){var p,x;
g.O(function(f){switch(f.Z){case 1:if(!u.Z)return bB(u,"onTransferProgress: "+l),f.return();if(u.Z.transferState==="TRANSFER_STATE_TRANSFERRING"){f.Ke(2);break}return g.c(f,DSx(u),2);case 2:p=Date.now();if(!(p-u.UJ>1E3)){f.Ke(4);break}u.UJ=p;return g.c(f,P1h(u.j,e.videoId,e.j,e.w2,e.bytesDownloaded,e.Z),5);case 5:if(u.Y&&!(u.Y&&p-u.wD>u.tZ)){f.Ke(4);break}u.wD=p;return g.c(f,hV(u,l),7);case 7:x=f.j,f1d({videoId:l,qO:u.Z,offlineModeType:x},e.bytesDownloaded,e.Z);case 4:u.X.start(108E5),g.F1(f)}})},
E_b=function(u){var l=(u.Z.transferRetryCount||0)<3;
l&&(u=u.Z,u.transferRetryCount=(u.transferRetryCount||0)+1);return l},qEh=function(u,l){l=l===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":l;
var e,p,x,f;return g.O(function(D){if(D.Z==1)return u.Z||bB(u,"setTransferToFailed: "+l),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l==="TRANSFER_FAILURE_REASON_NETWORK"?e="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.c(D,aS(u,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l),2);if(D.Z!=3)return xG(u.F9,{entityKey:(p=u.Z)==null?void 0:p.key,failureReason:e}),
x=u.Z?g.PD(u.Z.key).entityId:"",g.c(D,hV(u,x),3);f=D.j;var X={videoId:x,qO:u.Z,offlineModeType:f},m=l,M={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};m&&(M.transferFailureReason=m,M.failureReason=X5x(m));Gc(M,X);g.F1(D)})},aS=function(u,l,e,p){var x;
return g.O(function(f){if(f.Z==1){if(!u.Z)return bB(u,"saveTransferState: "+l),f.return();u.Z.transferState=l;u.Z.failureReason=p;g.vk(f,2);return g.c(f,f0b(u,function(D){return e?Yd(D,"offlineVideoStreams",u.Z.offlineVideoStreams).then(function(X){for(var m=g.F(X),M=m.next();!M.done;M=m.next())if((M=M.value)&&M.streamsProgress){M=g.F(M.streamsProgress);for(var E=M.next();!E.done;E=M.next())E.value.streamState=e}return Mkb(D,X.filter(function(q){return!!q}),"offlineVideoStreams")}):g.rC.resolve(void 0)}),
4)}if(f.Z!=2)return g.JK(f,0);
x=g.Hk(f);return x instanceof g.GV&&x.type==="QUOTA_EXCEEDED"?g.c(f,u.Hw("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):f.Ke(0)})},f0b=function(u,l){var e;
return g.O(function(p){if(!u.Z)return p.return();e=u.Z;return g.c(p,t_(u.j,{mode:"readwrite",yH:!0},function(x){var f=[bg(x,e,"transfer")];l&&f.push(l(x));return g.rC.all(f)}),0)})},U6=function(u){u.Z=void 0;
u.K=void 0;u.X.stop()},Gng=function(u,l){var e,p,x,f,D;
return g.O(function(X){if(X.Z==1)return e=g.PD(l.key),p=e.entityId,x=g.Ac(p,"playbackData"),g.c(X,nH(u.j,x,"playbackData"),2);f=X.j;if((D=f)==null?0:D.playerResponseJson)return X.return(JSON.parse(f.playerResponseJson));throw Error("No PlayerResponse found");})},bB=function(u,l){u.api.qj("woffle",{mcte:l});
ea("missing current transfer entity.")},hV=function(u,l){var e,p,x;
return g.O(function(f){if(f.Z==1)return g.c(f,nH(u.j,g.Ac(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);e=f.j;return f.return((x=(p=e)==null?void 0:p.offlineModeType)!=null?x:void 0)})},X0y=function(u){return rDT[u.transferState]!==void 0},mSx=function(u,l){var e=rDT[u.transferState],p=rDT[l.transferState];
return e!==p?e-p:Number(u.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},g7=function(u,l){var e=this;
this.Qo=u;this.api=l;this.B=new g.Z_;this.K=new g.mA;this.ji={l5:function(){return e.J.ji.l5()},
z3:function(){return e.B},
zW7:function(){return e.J},
OS:function(){return e.OS()},
pT:function(){return e.pT()},
IP:function(){return e.IP()},
zP:function(){return e.zP()},
F$:function(){return e.F$()},
If:function(p){return e.If(p)}};
this.J=new ulW(function(){return dSy(e)},function(){e.IP()},this.api.En(),this.api.W.bind(this.api));
this.Z=new pB(this.api);iTh(this.J)},dSy=function(u){return g.O(function(l){u.api.Nj("onOrchestrationBecameLeader");
return g.c(l,u.pT(),0)})},CJ2=function(u){var l,e;
return g.O(function(p){if(p.Z==1)return g.c(p,A_(),2);if(p.Z!=3){l=p.j;if(!l)return ea("PES is undefined"),p.return();u.j=new ueW(l,u.api,u.J,u.Z);e=u.oN(l);return g.c(p,jud(l,e,u.J,u.Z,u.Qo),3)}u.C=p.j;return g.c(p,SEg(u),0)})},SEg=function(u){var l;
return g.O(function(e){switch(e.Z){case 1:if(!u.j)return ea("transferManager is undefined"),e.return();if(u.j.Z){e.Ke(2);break}return g.c(e,YG(u.j),2);case 2:if(!u.Qo.W("woffle_enable_main_downloads_library")){e.Ke(4);break}return g.c(e,u.FY(),4);case 4:if(!u.Qo.W("html5_offline_playback_position_sync")){e.Ke(6);break}return g.c(e,u.gH(),7);case 7:return g.c(e,u.If(864E5),6);case 6:return g.c(e,u.refreshAllStaleEntities(43200,!0),9);case 9:return g.c(e,u.jY(),10);case 10:if(!u.Qo.W("html5_retry_downloads_for_expiration")){e.Ke(11);
break}return g.c(e,u.F$(),11);case 11:return u.G=g.qN(function(){u.refreshAllStaleEntities(43200,!0);u.jY()},9E5),g.gu(g.t$(),function(){return u.zP()}),g.c(e,A_(),13);
case 13:return l=e.j,g.c(e,Ah3(l),14);case 14:l1Z(u.J),g.F1(e)}})},sVT=function(){var u,l,e,p,x,f;
return g.O(function(D){switch(D.Z){case 1:return g.c(D,A_(),2);case 2:u=D.j;if(!u)return D.return([]);l=Date.now()/1E3;return g.c(D,Pw(u,"offlineVideoPolicy"),3);case 3:e=D.j,p=g.F(e),x=p.next();case 4:if(x.done){D.Ke(6);break}f=x.value;if(!(f.expirationTimestamp&&Number(f.expirationTimestamp)<l)){D.Ke(5);break}f.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";f.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.c(D,TF(u,f,"offlineVideoPolicy"),5);
case 5:x=p.next();D.Ke(4);break;case 6:return D.return(e.map(function(X){return X.key}))}})},IS=function(u,l,e,p,x){var f,D,X;
return g.O(function(m){if(m.Z==1)return g.c(m,A_(),2);f=m.j;if(!f)return m.return([]);D=l.map(function(M){var E=g.Ac(M,e);E={actionType:p,entityKey:E,actionMetadata:Object.assign({},qB2(),x)};p!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(E.actionMetadata.priority=0);M=new Sa(e,M,E);return s6(M)});
X=ooh(f,D);iTh(u.J);return m.return(X)})},VFd=function(u,l,e,p){var x,f,D,X,m,M,E,q;
return g.O(function(r){switch(r.Z){case 1:x=[],f=g.F(l),D=f.next();case 2:if(D.done){r.Ke(4);break}X=D.value;if(X.upToDate||e&&!X.shouldAutoSyncMetadata||!X.playlistId){r.Ke(3);break}m={};switch(p){case "mainPlaylistEntity":M={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:e};m={mainPlaylistEntityActionMetadata:M};break;case "musicPlaylist":E={autoSync:e},m={musicPlaylistEntityActionMetadata:E}}return g.c(r,IS(u,[X.playlistId],p,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m),6);case 6:(q=
r.j)&&x.push.apply(x,g.rj(q));case 3:D=f.next();r.Ke(2);break;case 4:return r.return(x)}})},o_x=function(u,l){var e;
return g.O(function(p){return l.length?(e=qB2(),g.cx(e,B$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),u.api.qj("qrd",{v:l.length}),p.return(IS(u,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e))):p.return([])})},W$3=function(u,l,e){this.Z=u;
this.Qo=l;this.J=e},yDy=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J;
return g.O(function(B){switch(B.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,f=[],g.vk(B,2),g.c(B,F$h(u,x),4);case 4:f=B.j;if(!(u.Qo.W("woffle_enable_main_downloads_library")&&((D=f)==null?0:D.length))){B.Ke(5);break}return g.c(B,QAb(u.Z,[l.entityKey]),5);case 5:g.JK(B,3);break;case 2:return X=g.Hk(B),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.GV&&X.type==="QUOTA_EXCEEDED"?(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):ea("Playlist add error"),B.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,m,M));case 3:E=[];if(!u.Qo.W("html5_offline_prevent_redownload_downloaded_video")){B.Ke(7);break}return g.c(B,M0v(u.Z,"mainVideoEntity",f),8);case 8:f=B.j;case 7:if((q=f)==null?0:q.length)for(r=g.F(f),d=r.next();!d.done;d=r.next())if(S=d.value,v=S.offlineVideoData,z=void 0,(z=v)==null?0:z.videoId)H=void 0,J=Number(((H=l.actionMetadata)==null?void 0:H.priority)||
0)+1,E.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v.videoId,"mainVideoEntity",J,tV,v_v(l,v,x)));return B.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,E))}})},QVx=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq,zN,ev,Q3,y,lr,zm,n3,Ly,hK,ih,eS,bE,Q,W,w,Z,I,X1,a,A,L,Qg,Sb,Gk,GN,br,zk,Ar,y3,Nx,wj,WN,kz,jb,wH;
return g.O(function(Gm){switch(Gm.Z){case 1:return e=Xq(l),p=l.entityKey,x=g.PD(p).entityId,f=[],D=!1,x==="!*$_ALL_ENTITIES_!*$"?(D=!0,g.c(Gm,Pw(u.Z,"mainPlaylistEntity"),5)):g.c(Gm,nH(u.Z,p,"mainPlaylistEntity"),4);case 4:(X=Gm.j)&&f.push(X);Gm.Ke(3);break;case 5:f=Gm.j;case 3:if((m=f)==null||!m.length)return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));M=g.Y(l.actionMetadata,zCg);q=(E=M)==null?void 0:E.nextAutoRefreshIntervalSeconds;d=(r=M)==null?void 0:r.autoSync;S=[];z=v=
!0;H=!1;if(!D&&d===!1){Gm.Ke(6);break}g.vk(Gm,7);return g.c(Gm,Uox(0,!!d,!0,f),9);case 9:S=Gm.j;g.JK(Gm,8);break;case 7:J=g.Hk(Gm);if(!(J instanceof Error&&J.message==="No data")){J instanceof Error&&J.message==="Empty response body"&&ea(J.message);Gm.Ke(8);break}return x==="!*$_ALL_ENTITIES_!*$"?g.c(Gm,o3N(u.Z,l,u.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.c(Gm,sAv(x,u.Z,l,u.J),8);case 8:if(!S.length||!D&&S[0].playlistId!==x)return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));case 6:if(D){B=[];N=g.F(S);for(U=N.next();!U.done;U=N.next())n=U.value,n.upToDate||d&&!n.shouldAutoSyncMetadata||!n.playlistId||(b={nextAutoRefreshIntervalSeconds:n.checkInSeconds,autoSync:d},B.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"mainPlaylistEntity",0,tV,{mainPlaylistEntityActionMetadata:b})));return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,B))}S.length&&(pm=S[0],H=!!pm.upToDate,d&&(v=(mO=pm.shouldAutoSyncMetadata)!=null?mO:!0,z=(xz=pm.shouldAutoSyncVideos)!=
null?xz:!0,pm.checkInSeconds&&(q=pm.checkInSeconds)));if(H||!v)return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));Em=[];ir=f[0];if(!ir.downloadState){oP=void 0;Gm.Ke(15);break}return g.c(Gm,nH(u.Z,ir.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:oP=Gm.j;case 15:return tK=oP,md=(($Z=tK)==null?0:$Z.addedTimestampMillis)?String(tK.addedTimestampMillis):void 0,g.vk(Gm,17),g.c(Gm,F$h(u,x,md,q),19);case 19:Em=Gm.j;g.JK(Gm,18);break;case 17:RP=g.Hk(Gm);if(!(RP instanceof
Error&&RP.message==="No data for playlist")){if(RP instanceof Error&&RP.message==="Empty response body for playlist")ea(RP.message);else return ck="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",lE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",RP instanceof g.GV&&RP.type==="QUOTA_EXCEEDED"&&(ck="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",lE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,ck,lE));
Gm.Ke(18);break}return g.c(Gm,sAv(x,u.Z,l,u.J),18);case 18:if(!z)return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));Og=[];Ug=new Map;if((Dc=Em)==null?0:Dc.length)for(k=g.F(Em),kq=k.next();!kq.done;kq=k.next())zN=kq.value,ev=zN.offlineVideoData,Q3=void 0,((Q3=ev)==null?0:Q3.videoId)&&Ug.set(ev.videoId,ev);y=new Map;lr=[];if((zm=ir)==null?0:(n3=zm.videos)==null?0:n3.length)for(Ly=g.F(ir.videos),hK=Ly.next();!hK.done;hK=Ly.next())if(ih=hK.value,eS=JSON.parse(g.PD(ih).entityId),
bE=eS.videoId)Ug.has(bE)?(y.set(bE,Ug.get(bE)),Ug.delete(bE)):lr.push(bE);W=Number(((Q=l.actionMetadata)==null?void 0:Q.priority)||0)+1;w=g.F(Ug.entries());for(Z=w.next();!Z.done;Z=w.next())I=Z.value,X1=g.F(I),a=X1.next().value,A=X1.next().value,L=a,Qg=A,Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L,"mainVideoEntity",W,tV,v_v(l,Qg,x)));Sb=g.F(y.entries());for(Gk=Sb.next();!Gk.done;Gk=Sb.next())GN=Gk.value,br=g.F(GN),zk=br.next().value,Ar=br.next().value,y3=zk,Nx=Ar,Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
y3,"mainVideoEntity",W,tV,v_v(l,Nx,x)));wj=g.F(lr);for(WN=wj.next();!WN.done;WN=wj.next())kz=WN.value,jb={playlistId:x},wH={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:jb},Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",kz,"mainVideoEntity",0,tV,wH));return Gm.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,Og))}})},w0N=function(u,l){var e,p,x,f;
return g.O(function(D){switch(D.Z){case 1:return e=Xq(l),g.vk(D,2),p=g.PD(l.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.c(D,o3N(u.Z,l,u.J,(x=l.actionMetadata)==null?void 0:(f=x.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.c(D,sAv(p,u.Z,l,u.J),6);case 6:if(!u.Qo.W("woffle_enable_main_downloads_library")){D.Ke(5);break}return g.c(D,w5d(u.Z,l.entityKey),5);case 5:g.JK(D,3);break;case 2:return g.Hk(D),D.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},F$h=function(u,l,e,p){var x,f,D,X,m,M,E;
return g.O(function(q){switch(q.Z){case 1:return g.c(q,RZx([l]),2);case 2:return x=q.j,g.c(q,JDb(u,x[0],e,p),3);case 3:return f=q.j,D=f.mainPlaylistEntity,X=f.BTe,M=SBZ(D,(m=X)==null?void 0:m.avatar),g.vk(q,4),g.c(q,oS(M),6);case 6:g.JK(q,5);break;case 4:E=g.Hk(q),E instanceof Error&&E.message==="Failed to fetch"&&ea(E.message);case 5:return q.return(x[0].videos)}})},JDb=function(u,l,e,p){var x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N;
return g.O(function(U){switch(U.Z){case 1:x=Date.now().toString();e||(e=x);f=l.videos;D=l.playlistId;X=[];m=[];if(f)for(M=g.F(f),E=M.next();!E.done;E=M.next()){q=E.value;r=q.offlineVideoData;if(!r||!r.videoId)throw ea("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");d=r.videoId;S={videoId:d,playlistId:D};v={id:g.Ac(JSON.stringify(S),"mainPlaylistVideoEntity"),video:g.Ac(d,"mainVideoEntity")};X.push(v);m.push(v.id)}H={key:g.Ac(D,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:e,lastSyncedTimestampMillis:x};J={key:g.Ac(D,"mainPlaylistEntity"),playlistId:D,videos:m,title:l.title,thumbnailStyleData:H_b(l),visibility:knH(l),downloadState:H.key};l.channel&&(B=l.channel.offlineChannelData,z=cDg(g.Ac(D,"ytMainChannelEntity"),B),J.channelOwner=z.id);((N=J)==null?0:N.entityMetadata)?(J.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,p&&(J.entityMetadata.nextAutoRefreshIntervalSeconds=String(p))):J&&(J.entityMetadata={nextAutoRefreshIntervalSeconds:p?
String(p):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});g.vk(U,2);return g.c(U,t_(u.Z,{mode:"readwrite",yH:!0},function(n){var b=bg(n,J,"mainPlaylistEntity"),pm=bg(n,H,"mainPlaylistDownloadStateEntity");b=[b,pm];pm=g.F(X);for(var mO=pm.next();!mO.done;mO=pm.next())b.push(bg(n,mO.value,"mainPlaylistVideoEntity"));z&&b.push(bg(n,z,"ytMainChannelEntity"));return g.rC.all(b)}),4);
case 4:g.JK(U,3);break;case 2:throw g.Hk(U),ea("PES failure for playlist"),Error("PES failure for playlist");case 3:return U.return({mainPlaylistEntity:J,BTe:z,osZ:X})}})},cDg=function(u,l){return{id:u,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},H_b=function(u){var l=[],e=u.videos;
e&&e.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:e[0].offlineVideoData.thumbnail}}});if((u=u.additionalMetadadatas)&&u.length>0)for(u=g.F(u),e=u.next();!e.done;e=u.next()){var p=e.value.offlineBundleItemPlaylistData,x=void 0;e=(x=p)==null?void 0:x.style;x=void 0;p={collageThumbnail:{coverThumbnail:(x=p)==null?void 0:x.coverThumbnail}};switch(e){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:p});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:p})}}return l},knH=function(u){switch(u.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},v_v=function(u,l,e){l={offlineVideoData:l,
playlistId:e};if(u=g.Y(u.actionMetadata,zCg))l.maximumDownloadQuality=u.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},O_H=function(u,l,e){this.Z=u;
this.Qo=l;this.J=e},Z_W=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S;
return g.O(function(v){switch(v.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,f=g.Y(l.actionMetadata,Tc),X=!((D=f)==null?0:D.playlistId),g.vk(v,2),g.c(v,jVv(u,x,void 0,(m=f)==null?void 0:m.offlineVideoData,X),4);case 4:g.JK(v,3);break;case 2:return M=g.Hk(v),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.GV&&M.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,E,q));case 3:r=1;r=Number(((d=l.actionMetadata)==null?void 0:d.priority)||0)+1;var z=(z=g.Y(l.actionMetadata,Tc))?{playbackDataActionMetadata:{maximumDownloadQuality:z.maximumDownloadQuality}}:void 0;S=c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x,"playbackData",r,BYx,z);return v.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,[S]))}})},L$Z=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J;
return g.O(function(B){switch(B.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,g.c(B,nH(u.Z,l.entityKey,"mainVideoEntity"),2);case 2:f=B.j;if(!f){D=void 0;B.Ke(3);break}return g.c(B,nH(u.Z,f.downloadState,"mainVideoDownloadStateEntity"),4);case 4:D=B.j;case 3:X=D;if(!f||!X)return B.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.vk(B,5);return g.c(B,jVv(u,x,X.addedTimestampMillis,(M=g.Y(l.actionMetadata,Tc))==null?void 0:M.offlineVideoData),7);case 7:E=1;E=Number(((q=
l.actionMetadata)==null?void 0:q.priority)||0)+1;m=c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x,"playbackData",E,BYx);g.JK(B,6);break;case 5:r=g.Hk(B);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof Error&&r.message==="Empty response body")ea(r.message);else return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.GV&&r.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,d,S));B.Ke(6);break}return g.c(B,v$(u.Z,x),9);case 9:v=B.j;z=g.Y(l.actionMetadata,Tc);if(J=(H=z)==null?void 0:H.playlistId)v.playlistId=J;v.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.c(B,W$(x,u.Z,l,u.J,v),6);case 6:return B.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,m?[m]:void 0))}})},NYZ=function(u,l){var e,p,x,f,D,X,m,M,E,q;
return g.O(function(r){switch(r.Z){case 1:return e=Xq(l),g.vk(r,2),p=g.PD(l.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.c(r,o3N(u.Z,l,u.J,(E=l.actionMetadata)==null?void 0:(q=E.offlineLoggingData)==null?void 0:q.offlineDeleteReason),5):g.c(r,v$(u.Z,p),6);case 6:x=r.j;f=g.Y(l.actionMetadata,Tc);if(X=(D=f)==null?void 0:D.playlistId)x.playlistId=X;x.offlineDeleteReason=(m=l.actionMetadata)==null?void 0:(M=m.offlineLoggingData)==null?void 0:M.offlineDeleteReason;return g.c(r,W$(p,u.Z,l,u.J,x),7);
case 7:if(!u.Qo.W("woffle_enable_main_downloads_library")){r.Ke(5);break}return g.c(r,w5d(u.Z,l.entityKey),5);case 5:g.JK(r,3);break;case 2:return g.Hk(r),r.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},jVv=function(u,l,e,p,x){var f,D,X,m,M,E;
return g.O(function(q){switch(q.Z){case 1:if(f=p){q.Ke(2);break}return g.c(q,N8T([l]),3);case 3:D=q.j,f=D[0];case 2:return g.c(q,RCb(u,f,e,x),4);case 4:X=q.j;m=X.mainVideoEntity;M=X.channelEntity;g.vk(q,5);var r=d7(m.thumbnail),d=d7(M.avatar);return g.c(q,oS(r.concat(d)),7);case 7:g.JK(q,0);break;case 5:E=g.Hk(q),E instanceof Error&&E.message==="Failed to fetch"&&ea(E.message),g.F1(q)}})},RCb=function(u,l,e,p){var x,f,D,X,m,M,E,q,r,d,S,v,z;
return g.O(function(H){switch(H.Z){case 1:e||(e=Date.now().toString());f=(x=l.channel)==null?void 0:x.offlineChannelData;D={id:g.Ac(l.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail};X={key:g.Ac(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Ac(l.videoId,"playbackData"),addedTimestampMillis:e,videoDownloadContextEntity:g.Ac(l.videoId,"videoDownloadContextEntity")};m={key:g.Ac(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};
u.Qo.W("html5_offline_playback_position_sync")&&(M={playbackPosition:m.key});E=g.Ac(l.videoId,"mainVideoEntity");q={key:E,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:M,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:D.id,downloadState:X.key};if(!u.Qo.W("woffle_enable_main_downloads_library")||
!p){H.Ke(2);break}return g.c(H,zZ3(u.Z,[E]),3);case 3:if(S=H.j)r=S.mainDownloadsLibraryEntity,d=S.mainDownloadsListEntity;case 2:return z=$oy,v={key:g.Ac(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.cx(X,z,v),g.c(H,t_(u.Z,{mode:"readwrite",yH:!0},function(J){var B=bg(J,D,"ytMainChannelEntity"),N=bg(J,X,"mainVideoDownloadStateEntity"),U=bg(J,q,"mainVideoEntity");B=[B,N,U];u.Qo.W("html5_offline_playback_position_sync")&&(N=bg(J,m,"videoPlaybackPositionEntity"),
B.push(N));r&&(N=bg(J,r,"mainDownloadsLibraryEntity"),B.push(N));d&&(N=bg(J,d,"mainDownloadsListEntity"),B.push(N));v&&(J=bg(J,v,"downloadStatusEntity"),B.push(J));return g.rC.all(B)}),4);
case 4:return H.return({mainVideoEntity:q,channelEntity:D})}})},K$3=function(u,l,e){this.Z=u;
this.Qo=l;this.J=e},YE3=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir;
return g.O(function(oP){switch(oP.Z){case 1:return e=Xq(l),p=[],g.c(oP,Ns.getInstance(),2);case 2:x=oP.j;if(!x){oP.Ke(3);break}return g.c(oP,x.get("sdois"),4);case 4:return f=oP.j,g.c(oP,(X=x)==null?void 0:X.get("lmqf"),5);case 5:D=oP.j;case 3:g.vk(oP,6);if(f===void 0)throw Error("prefStorage or opt-in state is undefined");m=[];if(f){oP.Ke(8);break}return g.c(oP,yyh(u.Z),9);case 9:m=oP.j,m.reverse();case 8:if(!m.length){oP.Ke(10);break}M=g.F(m);E=M.next();case 11:if(E.done){oP.Ke(10);break}q=E.value;
if(!q){oP.Ke(12);break}r=g.PD(q).entityId;return g.c(oP,v$(u.Z,r),14);case 14:return d=oP.j,d.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.c(oP,W$(r,u.Z,{entityKey:q,actionType:l.actionType},u.J,d),12);case 12:E=M.next();oP.Ke(11);break;case 10:return g.c(oP,hZH(f,(S=D)!=null?S:"SD"),16);case 16:return v=oP.j,g.c(oP,WcH(v),17);case 17:z=v32(v);if(!u.Qo.W("woffle_enable_main_downloads_library")){oP.Ke(18);break}if(f){oP.Ke(19);break}return g.c(oP,w5d(u.Z,g.jj),19);case 19:return g.c(oP,
QAb(u.Z,[g.jj]),18);case 18:if((H=z)==null?0:H.length)for(J=g.F(z),B=J.next();!B.done;B=J.next())if(U=N=B.value,n=U.actionType,b=U.entityKey,pm=U.actionMetadata,n&&b&&pm&&!g.Y(pm,USx)){n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(pm.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(mO=g.Y(N.actionMetadata,Tc))mO.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",N.actionMetadata=Object.assign({},N.actionMetadata,{mainVideoEntityActionMetadata:mO});p.push(N)}g.JK(oP,
7);break;case 6:return xz=g.Hk(oP),Em="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ir="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",xz instanceof g.GV&&xz.type==="QUOTA_EXCEEDED"&&(Em="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ir="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),oP.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,Em,ir));case 7:return oP.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,p))}})},hCh=function(){g7.apply(this,
arguments);
this.Y="mainVideoEntity"},b_W=function(u,l,e){l=l===void 0?43200:l;
e=e===void 0?!0:e;var p=p===void 0?!1:p;var x,f,D;return g.O(function(X){switch(X.Z){case 1:if(!u.B.OG())return X.return([]);x=[];g.vk(X,2);return g.c(X,Uox(l,e,p),4);case 4:x=X.j;g.JK(X,3);break;case 2:f=g.Hk(X),f instanceof Error&&f.message==="No data"||f instanceof Error&&f.message==="Empty response body"&&ea(f.message);case 3:return D=VFd(u,x,e,"mainPlaylistEntity"),X.return(D)}})},a0g=function(u,l,e,p){p=p===void 0?!1:p;
var x,f,D,X,m,M,E,q,r,d,S,v,z,H,J;return g.O(function(B){switch(B.Z){case 1:return x=[],g.c(B,YBx(),2);case 2:return(f=B.j)||p?g.c(B,bTg(l,e),3):B.return([]);case 3:D=B.j;if((X=D)==null||!X.length)return B.return([]);m={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};M=g.F(D);E=M.next();case 4:if(E.done){B.Ke(6);break}r=q=E.value;d=r.actionType;S=r.entityKey;v=r.actionMetadata;if(!(d&&S&&v)||g.Y(v,USx)){B.Ke(5);break}d==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.offlineLoggingData=
m);z=g.PD(S);H=z.entityId;return g.c(B,IS(u,[H],"mainVideoEntity",d,v),8);case 8:J=B.j,x=x.concat(J);case 5:E=M.next();B.Ke(4);break;case 6:return B.return(x)}})},g_x=function(u,l){this.Z=u;
this.J=l},tFh=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H;
return g.O(function(J){switch(J.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,f=[],g.vk(J,2),g.c(J,I0b(u,x),4);case 4:f=J.j;if((D=f)==null||!D.length){J.Ke(5);break}return g.c(J,OTN(u.Z,l.entityKey),5);case 5:g.JK(J,3);break;case 2:return X=g.Hk(J),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.GV&&X.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
J.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,m,M));case 3:return E=[],g.c(J,M0v(u.Z,"musicTrack",f),7);case 7:f=J.j;if(f.length)for(q=g.F(f),r=q.next();!r.done;r=q.next())if(d=r.value,S=d.offlineVideoData,v=void 0,(v=S)==null?0:v.videoId)z=void 0,H=Number(((z=l.actionMetadata)==null?void 0:z.priority)||0)+1,E.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"musicTrack",H,nB,w7(l,S,x)));return J.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,E))}})},
TY2=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq,zN,ev,Q3,y,lr,zm,n3,Ly,hK,ih,eS,bE,Q,W,w,Z,I,X1,a,A;
return g.O(function(L){switch(L.Z){case 1:return e=Xq(l),p=l.entityKey,x=g.PD(p).entityId,f=[],D=!1,x==="!*$_ALL_ENTITIES_!*$"?(D=!0,g.c(L,Pw(u.Z,"musicAlbumRelease"),5)):g.c(L,nH(u.Z,p,"musicAlbumRelease"),4);case 4:(X=L.j)&&f.push(X);L.Ke(3);break;case 5:f=L.j;case 3:if((m=f)==null||!m.length)return L.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));if(D){M=[];E=g.F(f);for(q=E.next();!q.done;q=E.next())r=q.value,d=g.PD(r.id).entityId,M.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
d,"musicAlbumRelease",0,nB));return L.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,M))}S=[];v=f[0];z=void 0;if(!v.downloadMetadata){L.Ke(6);break}return g.c(L,nH(u.Z,v.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:H=L.j,z=Number((B=(J=H)==null?void 0:J.addedTimestampMillis)!=null?B:"0")/1E3;case 6:return g.vk(L,8),g.c(L,I0b(u,x,(N=z)==null?void 0:N.toString()),10);case 10:S=L.j;g.JK(L,9);break;case 8:U=g.Hk(L);if(!(U instanceof Error&&U.message==="No data")){if(U instanceof
Error&&U.message==="Empty response body")ea(U.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.GV&&U.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,n,b));L.Ke(9);break}return g.c(L,zc(x,"musicAlbumRelease",u.Z,l,u.J),9);case 9:pm=[];mO=new Map;
if((xz=S)==null?0:xz.length)for(Em=g.F(S),ir=Em.next();!ir.done;ir=Em.next())oP=ir.value,tK=oP.offlineVideoData,$Z=void 0,(($Z=tK)==null?0:$Z.videoId)&&mO.set(tK.videoId,tK);md=new Map;RP=[];if((ck=v)==null?0:(lE=ck.tracks)==null?0:lE.length)for(Og=g.F(v.tracks),Ug=Og.next();!Ug.done;Ug=Og.next())if(Dc=Ug.value,k=g.PD(Dc).entityId)mO.has(k)?(md.set(k,mO.get(k)),mO.delete(k)):RP.push(k);zN=Number(((kq=l.actionMetadata)==null?void 0:kq.priority)||0)+1;ev=g.F(mO.entries());for(Q3=ev.next();!Q3.done;Q3=
ev.next())y=Q3.value,lr=g.F(y),zm=lr.next().value,n3=lr.next().value,Ly=zm,hK=n3,pm.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ly,"musicTrack",zN,nB,w7(l,hK)));ih=g.F(md.entries());for(eS=ih.next();!eS.done;eS=ih.next())bE=eS.value,Q=g.F(bE),W=Q.next().value,w=Q.next().value,Z=W,I=w,pm.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z,"musicTrack",zN,nB,w7(l,I)));X1=g.F(RP);for(a=X1.next();!a.done;a=X1.next())A=a.value,pm.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",A,"musicTrack",
0,nB));return L.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,pm))}})},n_3=function(u,l){var e,p;
return g.O(function(x){switch(x.Z){case 1:return e=Xq(l),g.vk(x,2),p=g.PD(l.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.c(x,Qs(u.Z,l,u.J),5):g.c(x,zc(p,"musicAlbumRelease",u.Z,l,u.J),6);case 6:return g.c(x,jAd(u.Z,l.entityKey),5);case 5:g.JK(x,3);break;case 2:return g.Hk(x),x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},I0b=function(u,l,e){var p,x,f;
return g.O(function(D){switch(D.Z){case 1:return g.c(D,RZx([l]),2);case 2:return p=D.j,g.c(D,PJb(u,p[0],e),3);case 3:return x=D.j,f=d7(x.thumbnailDetails),g.c(D,oS(f),4);case 4:return D.return(p[0].videos)}})},PJb=function(u,l,e){var p,x,f,D,X,m,M,E,q,r,d,S,v,z;
return g.O(function(H){if(H.Z==1){p=l.additionalMetadadatas;x=void 0;if(p&&p.length>0)for(f=g.F(p),D=f.next();!D.done;D=f.next())if(X=D.value,X.offlineMusicPlaylistData){x=X.offlineMusicPlaylistData;break}m=l.playlistId;M=B8x(l);E=M.Xa;q=M.JH;r=e?(Number(e)*1E3).toString():Date.now().toString();d=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";S={id:g.Ac(m,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:q,lastModifiedTimestampMillis:d,addedTimestampMillis:r,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};v={id:g.Ac(m,"musicAlbumRelease"),title:l.title,audioPlaylistId:m,trackCount:l.totalVideoCount,tracks:E,downloadMetadata:S.id};x&&(v.thumbnailDetails=(z=x.albumHqThumbnail)!=null?z:x.albumArtistThumbnail,v.artistDisplayName=x.albumArtistDisplayName,v.releaseDate=x.albumReleaseDate,v.contentRating={explicitType:x.albumReleaseExplicitType},v.releaseType=x.albumReleaseType);return g.c(H,t_(u.Z,{mode:"readwrite",yH:!0},function(J){var B=bg(J,v,"musicAlbumRelease");
J=bg(J,S,"musicAlbumReleaseDownloadMetadataEntity");return g.rC.all([B,J])}),2)}return H.return(v)})},ADW=function(u,l){this.Z=u;
this.J=l},i6x=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H;
return g.O(function(J){switch(J.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,f=[],g.vk(J,2),g.c(J,u$H(u,x),4);case 4:f=J.j;if((D=f)==null||!D.length){J.Ke(5);break}return g.c(J,OTN(u.Z,l.entityKey),5);case 5:g.JK(J,3);break;case 2:return X=g.Hk(J),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.GV&&X.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
J.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,m,M));case 3:return E=[],g.c(J,M0v(u.Z,"musicTrack",f),7);case 7:f=J.j;if(f.length)for(q=g.F(f),r=q.next();!r.done;r=q.next())if(d=r.value,S=d.offlineVideoData,v=void 0,(v=S)==null?0:v.videoId)z=void 0,H=Number(((z=l.actionMetadata)==null?void 0:z.priority)||0)+1,E.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"musicTrack",H,P$,w7(l,S,x)));return J.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,E))}})},
lsy=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug,Dc,k,kq,zN,ev,Q3,y,lr,zm,n3,Ly,hK,ih,eS,bE,Q,W,w,Z,I,X1,a,A,L,Qg,Sb,Gk,GN,br,zk,Ar,y3,Nx,wj,WN;
return g.O(function(kz){switch(kz.Z){case 1:return e=Xq(l),p=l.entityKey,x=g.PD(p).entityId,f=[],D=!1,x==="!*$_ALL_ENTITIES_!*$"?(D=!0,g.c(kz,Pw(u.Z,"musicPlaylist"),5)):g.c(kz,nH(u.Z,p,"musicPlaylist"),4);case 4:(X=kz.j)&&f.push(X);kz.Ke(3);break;case 5:f=kz.j;case 3:if((m=f)==null||!m.length)return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));M=g.Y(l.actionMetadata,ZTb);q=(E=M)==null?void 0:E.autoSync;r=[];S=d=!0;v=!1;z=void 0;if(!D&&q===!1){kz.Ke(6);break}g.vk(kz,7);return g.c(kz,
a1b(0,!!q,!0,f),9);case 9:r=kz.j;g.JK(kz,8);break;case 7:H=g.Hk(kz);if(!(H instanceof Error&&H.message==="No data")){H instanceof Error&&H.message==="Empty response body"&&ea(H.message);kz.Ke(8);break}return x==="!*$_ALL_ENTITIES_!*$"?g.c(kz,Qs(u.Z,l,u.J),8):g.c(kz,zc(x,"musicPlaylist",u.Z,l,u.J),8);case 8:if(!r.length||!D&&r[0].playlistId!==x)return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));case 6:if(D){J=[];B=g.F(r);for(N=B.next();!N.done;N=B.next())U=N.value,U.upToDate||
q&&!U.shouldAutoSyncMetadata||!U.playlistId||(n={autoSync:q},J.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"musicPlaylist",0,P$,{musicPlaylistEntityActionMetadata:n})));return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,J))}r.length&&(b=r[0],v=!!b.upToDate,q&&(d=(pm=b.shouldAutoSyncMetadata)!=null?pm:!0,S=(mO=b.shouldAutoSyncVideos)!=null?mO:!0,b.checkInSeconds&&(z=b.checkInSeconds)));if(v||!d)return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));xz=[];Em=f[0];ir=void 0;if(!Em.downloadMetadata){kz.Ke(15);break}return g.c(kz,nH(u.Z,Em.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:oP=kz.j,ir=Number(($Z=(tK=oP)==null?void 0:tK.addedTimestampMillis)!=null?$Z:"0")/1E3;case 15:return g.vk(kz,17),g.c(kz,u$H(u,x,(md=ir)==null?void 0:md.toString(),z),19);case 19:xz=kz.j;g.JK(kz,18);break;case 17:RP=g.Hk(kz);if(!(RP instanceof Error&&RP.message==="No data")){if(RP instanceof Error&&RP.message==="Empty response body")ea(RP.message);
else return ck="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",lE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",RP instanceof g.GV&&RP.type==="QUOTA_EXCEEDED"&&(ck="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",lE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,ck,lE));kz.Ke(18);break}return g.c(kz,zc(x,"musicPlaylist",u.Z,l,u.J),18);case 18:if(!S)return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));Og=[];Ug=new Map;if((Dc=xz)==null?0:Dc.length)for(k=g.F(xz),kq=k.next();!kq.done;kq=k.next())zN=kq.value,ev=zN.offlineVideoData,Q3=void 0,((Q3=ev)==null?0:Q3.videoId)&&Ug.set(ev.videoId,ev);y=new Map;lr=[];if((zm=Em)==null?0:(n3=zm.tracks)==null?0:n3.length)for(Ly=g.F(Em.tracks),hK=Ly.next();!hK.done;hK=Ly.next())if(ih=hK.value,eS=g.PD(ih).entityId)Ug.has(eS)?(y.set(eS,Ug.get(eS)),Ug.delete(eS)):lr.push(eS);Q=Number(((bE=l.actionMetadata)==null?void 0:bE.priority)||0)+1;W=g.F(Ug.entries());for(w=
W.next();!w.done;w=W.next())Z=w.value,I=g.F(Z),X1=I.next().value,a=I.next().value,A=X1,L=a,Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"musicTrack",Q,P$,w7(l,L)));Qg=g.F(y.entries());for(Sb=Qg.next();!Sb.done;Sb=Qg.next())Gk=Sb.value,GN=g.F(Gk),br=GN.next().value,zk=GN.next().value,Ar=br,y3=zk,Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Ar,"musicTrack",Q,P$,w7(l,y3)));Nx=g.F(lr);for(wj=Nx.next();!wj.done;wj=Nx.next())WN=wj.value,Og.push(c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
WN,"musicTrack",0,P$));return kz.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,Og))}})},eGh=function(u,l){var e,p;
return g.O(function(x){switch(x.Z){case 1:return e=Xq(l),g.vk(x,2),p=g.PD(l.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.c(x,Qs(u.Z,l,u.J),5):g.c(x,zc(p,"musicPlaylist",u.Z,l,u.J),6);case 6:return g.c(x,jAd(u.Z,l.entityKey),5);case 5:g.JK(x,3);break;case 2:return g.Hk(x),x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},u$H=function(u,l,e,p){var x,f,D;
return g.O(function(X){switch(X.Z){case 1:return g.c(X,RZx([l]),2);case 2:return x=X.j,g.c(X,pVb(u,x[0],e,p),3);case 3:return f=X.j,D=d7(f.thumbnailDetails),g.c(X,oS(D),4);case 4:return X.return(x[0].videos)}})},pVb=function(u,l,e,p){var x,f,D,X,m,M,E,q,r;
return g.O(function(d){return d.Z==1?(x=l.playlistId,f=B8x(l),D=f.Xa,X=f.JH,m=e?(Number(e)*1E3).toString():Date.now().toString(),M=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",E={id:g.Ac(x,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:X,lastModifiedTimestampMillis:M,addedTimestampMillis:m,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},q={id:g.Ac(x,"musicPlaylist"),title:l.title,playlistId:x,thumbnailDetails:l.thumbnail,visibility:xNy(l),trackCount:l.totalVideoCount,
tracks:D,downloadMetadata:E.id},p&&(((r=q)==null?0:r.entityMetadata)?q.entityMetadata.nextAutoRefreshIntervalSeconds=String(p):q&&(q.entityMetadata={nextAutoRefreshIntervalSeconds:String(p)})),g.c(d,t_(u.Z,{mode:"readwrite",yH:!0},function(S){var v=bg(S,q,"musicPlaylist");S=bg(S,E,"musicPlaylistDownloadMetadataEntity");return g.rC.all([v,S])}),2)):d.return(q)})},xNy=function(u){switch(u.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},fsg=function(u,l){this.Z=u;
this.J=l},mNH=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S;
return g.O(function(v){switch(v.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,f=g.Y(l.actionMetadata,DNv),g.vk(v,2),g.c(v,G8x(u,x,void 0,(D=f)==null?void 0:D.track,(X=f)==null?void 0:X.albumRelease),4);case 4:if((m=f)==null?0:m.playlistId){v.Ke(5);break}return g.c(v,OTN(u.Z,l.entityKey),5);case 5:g.JK(v,3);break;case 2:return M=g.Hk(v),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.GV&&M.type==="QUOTA_EXCEEDED"&&
(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,E,q));case 3:d=Number(((r=l.actionMetadata)==null?void 0:r.priority)||0)+1;var z=(z=g.Y(l.actionMetadata,DNv))?{playbackDataActionMetadata:{maximumDownloadQuality:z.maximumDownloadQuality}}:void 0;S=c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x,"playbackData",d,XVv,z);return v.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e,[S]))}})},$N3=function(u,l){var e,p,x,f,D,X,m,M,E,q,r,d,S,v,z;
return g.O(function(H){switch(H.Z){case 1:return e=Xq(l),p=g.PD(l.entityKey),x=p.entityId,g.c(H,nH(u.Z,l.entityKey,"musicTrack"),2);case 2:f=H.j;if(!f){D=void 0;H.Ke(3);break}return g.c(H,nH(u.Z,f.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:D=H.j;case 3:X=D;if(!f||!X)return H.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));M=g.Y(l.actionMetadata,DNv);g.vk(H,5);return g.c(H,G8x(u,x,X.addedTimestampMillis,(E=M)==null?void 0:E.track,(q=M)==null?void 0:q.albumRelease),
7);case 7:d=Number(((r=l.actionMetadata)==null?void 0:r.priority)||0)+1;m=c$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x,"playbackData",d,XVv);g.JK(H,6);break;case 5:S=g.Hk(H);if(!(S instanceof Error&&S.message==="No data")){if(S instanceof Error&&S.message==="Empty response body")ea(S.message);else return v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.GV&&S.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,v,z));H.Ke(6);break}return g.c(H,ys(x,u.Z,l,u.J),6);case 6:return H.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,m?[m]:void 0))}})},MLN=function(u,l){var e,p;
return g.O(function(x){switch(x.Z){case 1:return e=Xq(l),g.vk(x,2),p=g.PD(l.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.c(x,Qs(u.Z,l,u.J),5):g.c(x,ys(p,u.Z,l,u.J),6);case 6:return g.c(x,jAd(u.Z,l.entityKey),5);case 5:g.JK(x,3);break;case 2:return g.Hk(x),x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new O6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},G8x=function(u,l,e,p,x){var f,D,X,m,M,E;
return g.O(function(q){switch(q.Z){case 1:if(f=p){q.Ke(2);break}return g.c(q,N8T([l]),3);case 3:D=q.j,X=D[0],f=cyT(X);case 2:return g.c(q,El2(u,f,l,x,e),4);case 4:m=q.j;M=m.musicTrackEntity;E=m.dc;var r=d7(M.thumbnailDetails),d=[];E&&(d=d7(E.thumbnailDetails));return g.c(q,oS(r.concat(d)),0)}})},El2=function(u,l,e,p,x){var f;
return g.O(function(D){return D.Z==1?(x||(x=Date.now().toString()),f={id:g.Ac(e,"musicTrackDownloadMetadataEntity"),playbackData:g.Ac(e,"playbackData"),addedTimestampMillis:x,videoDownloadContextEntity:g.Ac(e,"videoDownloadContextEntity")},p&&(l.albumRelease=p.id),g.c(D,t_(u.Z,{mode:"readwrite",yH:!0},function(X){var m=[],M=bg(X,f,"musicTrackDownloadMetadataEntity");m.push(M);M=bg(X,l,"musicTrack");m.push(M);p&&(X=bg(X,p,"musicAlbumRelease"),m.push(X));return g.rC.all(m)}),2)):D.Z!=3?g.c(D,E6(e,"musicTrackDownloadMetadataEntity",
u.Z,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):D.return({musicTrackEntity:l,
dc:p})})},AV=function(){g7.apply(this,arguments);
this.Y="musicTrack"},qex=function(u,l,e){l=l===void 0?43200:l;
e=e===void 0?!0:e;var p=p===void 0?!1:p;var x,f;return g.O(function(D){switch(D.Z){case 1:if(!u.B.OG())return D.return([]);x=[];g.vk(D,2);return g.c(D,a1b(l,e,p),4);case 4:x=D.j;g.JK(D,3);break;case 2:g.Hk(D);case 3:return f=VFd(u,x,e,"musicPlaylist"),D.return(f)}})},rCd=function(){g.Wb.apply(this,arguments);
var u=this;this.events=new g.wt(this);this.Qo=this.player.S();this.ji={J0s:function(){return u.Z},
fL:function(){return u.fL()},
aU:function(l){return u.aU(l)}}},dNx=function(u){var l;
u=g.Y((l=u.getWatchNextResponse())==null?void 0:l.currentVideoEndpoint,g.wv);if(u==null?0:u.playlistId)var e=u.playlistId;return e},Sev=function(u,l){var e,p,x,f;
return g.O(function(D){if(D.Z==1){e=l.clientPlaybackNonce;p={cpn:e,offlineSourceVisualElement:g.qC(l.F9||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.j&&(p.videoFmt=Number(l.j.itag));l.X&&(p.audioFmt=Number(l.X.itag));if((x=dNx(l))&&l.videoId){var X=l.videoId;X=x!=="PPSV"?Promise.resolve(!1):u.Z.PK(X);D=g.c(D,X,3)}else D=D.Ke(2);return D}D.Z!=2&&(f=D.j)&&(p.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");u.j=e;g.MC("offlinePlaybackStarted",p);g.F1(D)})};
g.tq.prototype.Gt=g.fm(45,function(u){return this.app.Gt(u)});
g.r1.prototype.Gt=g.fm(44,function(u){return g.oam(this,9,u)});
g.V(Zf,Bw);g.Dl.Object.defineProperties(Zf.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Z.entityMetadata},
set:function(u){this.Z.entityMetadata=u}}});
g.V(plx,Zf);plx.prototype.j=function(){return[]};
g.V(xux,Zf);xux.prototype.j=function(){return[]};
g.V(fjx,Zf);fjx.prototype.j=function(){return[]};
g.V(Dux,Zf);Dux.prototype.j=function(){return[]};
g.V(Gqb,Zf);Gqb.prototype.j=function(){return[]};
g.V(Xlg,Zf);Xlg.prototype.j=function(){var u=[];this.Z.alternateChannel&&u.push(this.Z.alternateChannel);this.Z.alternateChannelList&&u.push.apply(u,g.rj(this.Z.alternateChannelList));this.Z.oneofChannelEntity&&u.push(this.Z.oneofChannelEntity);return[].concat(g.rj(new Set(u)))};
g.V(muW,Zf);muW.prototype.j=function(){var u=[];this.Z.entryCollection&&u.push(this.Z.entryCollection);return[].concat(g.rj(new Set(u)))};
g.V($ux,Bw);$ux.prototype.j=function(){var u=[];this.Z.video&&u.push(this.Z.video);return[].concat(g.rj(new Set(u)))};
g.V(M7y,Zf);M7y.prototype.j=function(){var u=[];this.Z.parentPlaylist&&u.push(this.Z.parentPlaylist);if(this.Z.entries)for(var l=g.F(this.Z.entries),e=l.next();!e.done;e=l.next())u.push.apply(u,g.rj((new $ux(e.value)).j()));return[].concat(g.rj(new Set(u)))};
g.V(E2b,Zf);E2b.prototype.j=function(){var u=[];this.Z.descriptionEntity&&u.push(this.Z.descriptionEntity);this.Z.creators&&u.push.apply(u,g.rj(this.Z.creators));this.Z.theBiggestFan&&u.push(this.Z.theBiggestFan);return[].concat(g.rj(new Set(u)))};
g.V(q9v,Zf);q9v.prototype.j=function(){return[]};
g.V(rtb,Zf);rtb.prototype.j=function(){return[]};
g.V(duh,Zf);duh.prototype.j=function(){return[]};
g.V(S9N,Zf);S9N.prototype.j=function(){return[]};
g.V(CVT,Zf);CVT.prototype.j=function(){return[]};
g.V(skg,Zf);skg.prototype.j=function(){return[]};
g.V(V7d,Zf);V7d.prototype.j=function(){return[]};
g.V(o23,Zf);o23.prototype.j=function(){return[]};
g.V(WFd,Zf);WFd.prototype.j=function(){return[]};
g.V(FFx,Zf);FFx.prototype.j=function(){var u=[];this.Z.downloadsList&&u.push(this.Z.downloadsList);this.Z.smartDownloadsList&&u.push(this.Z.smartDownloadsList);this.Z.recommendedDownloadsList&&u.push(this.Z.recommendedDownloadsList);this.Z.refresh&&u.push(this.Z.refresh);return[].concat(g.rj(new Set(u)))};
g.V(v2W,Bw);v2W.prototype.j=function(){var u=[];this.Z.video&&u.push(this.Z.video);this.Z.playlist&&u.push(this.Z.playlist);this.Z.videoItem&&u.push(this.Z.videoItem);this.Z.playlistItem&&u.push(this.Z.playlistItem);return[].concat(g.rj(new Set(u)))};
g.V(ytx,Zf);ytx.prototype.j=function(){var u=[];this.Z.refresh&&u.push(this.Z.refresh);if(this.Z.downloads)for(var l=g.F(this.Z.downloads),e=l.next();!e.done;e=l.next())u.push.apply(u,g.rj((new v2W(e.value)).j()));return[].concat(g.rj(new Set(u)))};
g.V(zdb,Zf);zdb.prototype.j=function(){var u=[];this.Z.localImageEntities&&u.push.apply(u,g.rj(this.Z.localImageEntities));return[].concat(g.rj(new Set(u)))};
g.V(QkN,Zf);QkN.prototype.j=function(){var u=[];this.Z.playbackData&&u.push(this.Z.playbackData);this.Z.localImageEntities&&u.push.apply(u,g.rj(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&u.push(this.Z.videoDownloadContextEntity);return[].concat(g.rj(new Set(u)))};
g.V(wlb,Zf);wlb.prototype.j=function(){return[]};
g.V(Jt3,Zf);Jt3.prototype.j=function(){var u=[];this.Z.fakeChildren&&u.push.apply(u,g.rj(this.Z.fakeChildren));return[].concat(g.rj(new Set(u)))};
g.V(Hdh,Zf);Hdh.prototype.j=function(){var u=[];this.Z.video&&u.push(this.Z.video);this.Z.playbackData&&u.push(this.Z.playbackData);this.Z.offlineVideoPolicy&&u.push(this.Z.offlineVideoPolicy);return[].concat(g.rj(new Set(u)))};
g.V(kqb,Zf);kqb.prototype.j=function(){return[]};
g.V(ctT,Zf);ctT.prototype.j=function(){var u=[];this.Z.channelOwner&&u.push(this.Z.channelOwner);this.Z.videos&&u.push.apply(u,g.rj(this.Z.videos));this.Z.collaboratorChannels&&u.push.apply(u,g.rj(this.Z.collaboratorChannels));this.Z.downloadState&&u.push(this.Z.downloadState);this.Z.refresh&&u.push(this.Z.refresh);return[].concat(g.rj(new Set(u)))};
g.V(Odv,Zf);Odv.prototype.j=function(){var u=[];this.Z.video&&u.push(this.Z.video);this.Z.channelContributor&&u.push(this.Z.channelContributor);return[].concat(g.rj(new Set(u)))};
g.V(jkx,Bw);jkx.prototype.j=function(){var u=[];this.Z.localImageEntities&&u.push.apply(u,g.rj(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&u.push(this.Z.videoDownloadContextEntity);return[].concat(g.rj(new Set(u)))};
g.V(BPd,Bw);BPd.prototype.j=function(){var u=[];this.Z.recommendedVideoMetadata&&u.push.apply(u,g.rj((new jkx(this.Z.recommendedVideoMetadata)).j()));return[].concat(g.rj(new Set(u)))};
g.V(ZdH,Bw);ZdH.prototype.j=function(){var u=[];this.Z.playbackPosition&&u.push(this.Z.playbackPosition);return[].concat(g.rj(new Set(u)))};
g.V(LFx,Zf);LFx.prototype.j=function(){var u=[];this.Z.owner&&u.push(this.Z.owner);this.Z.downloadState&&u.push(this.Z.downloadState);this.Z.userState&&u.push.apply(u,g.rj((new ZdH(this.Z.userState)).j()));this.Z.additionalMetadata&&u.push.apply(u,g.rj((new BPd(this.Z.additionalMetadata)).j()));return[].concat(g.rj(new Set(u)))};
g.V(NPZ,Zf);NPZ.prototype.j=function(){var u=[];this.Z.userChannelDetails&&u.push(this.Z.userChannelDetails);return[].concat(g.rj(new Set(u)))};
g.V(RdN,Zf);RdN.prototype.j=function(){var u=[];this.Z.channelOwner&&u.push(this.Z.channelOwner);this.Z.playbackPosition&&u.push(this.Z.playbackPosition);this.Z.localImageEntities&&u.push.apply(u,g.rj(this.Z.localImageEntities));this.Z.downloadStatus&&u.push(this.Z.downloadStatus);return[].concat(g.rj(new Set(u)))};
g.V(KFH,Zf);KFH.prototype.j=function(){return[]};
g.V(Uux,Zf);Uux.prototype.j=function(){return[]};
g.V(Y9d,Zf);Y9d.prototype.j=function(){return[]};
g.V(hdv,Zf);hdv.prototype.j=function(){return[]};
g.V(bd3,Zf);bd3.prototype.j=function(){return[]};
g.V(ajb,Zf);ajb.prototype.j=function(){return[]};
g.V(g23,Zf);g23.prototype.j=function(){return[]};
g.V(Ij2,Zf);Ij2.prototype.j=function(){return[]};
g.V(t7d,Zf);t7d.prototype.j=function(){return[]};
g.V(TPb,Zf);TPb.prototype.j=function(){return[]};
g.V(n2g,Zf);n2g.prototype.j=function(){return[]};
g.V(PVg,Zf);PVg.prototype.j=function(){return[]};
g.V(Atb,Zf);Atb.prototype.j=function(){return[]};
g.V(uwb,Zf);uwb.prototype.j=function(){var u=[];this.Z.compositeSourceKeys&&u.push.apply(u,g.rj(this.Z.compositeSourceKeys));return[].concat(g.rj(new Set(u)))};
g.V(iDd,Zf);iDd.prototype.j=function(){var u=[];this.Z.trackDownloadMetadatas&&u.push.apply(u,g.rj(this.Z.trackDownloadMetadatas));return[].concat(g.rj(new Set(u)))};
g.V(lKH,Zf);
lKH.prototype.j=function(){var u=[];this.Z.downloadedTracks&&u.push.apply(u,g.rj(this.Z.downloadedTracks));this.Z.smartDownloadedTracks&&u.push.apply(u,g.rj(this.Z.smartDownloadedTracks));this.Z.downloadedEpisodes&&u.push.apply(u,g.rj(this.Z.downloadedEpisodes));this.Z.downloadedAlbumReleases&&u.push.apply(u,g.rj(this.Z.downloadedAlbumReleases));this.Z.smartDownloadedAlbumReleases&&u.push.apply(u,g.rj(this.Z.smartDownloadedAlbumReleases));this.Z.downloadedPlaylists&&u.push.apply(u,g.rj(this.Z.downloadedPlaylists));this.Z.smartDownloadedPlaylists&&
u.push.apply(u,g.rj(this.Z.smartDownloadedPlaylists));this.Z.metadataOnlyTracks&&u.push.apply(u,g.rj(this.Z.metadataOnlyTracks));return[].concat(g.rj(new Set(u)))};
g.V(ey3,Zf);ey3.prototype.j=function(){var u=[];this.Z.trackDownloadMetadatas&&u.push.apply(u,g.rj(this.Z.trackDownloadMetadatas));return[].concat(g.rj(new Set(u)))};
g.V(pnh,Zf);pnh.prototype.j=function(){var u=[];this.Z.playbackData&&u.push(this.Z.playbackData);this.Z.localImageEntities&&u.push.apply(u,g.rj(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&u.push(this.Z.videoDownloadContextEntity);return[].concat(g.rj(new Set(u)))};
g.V(xJN,Zf);xJN.prototype.j=function(){var u=[];this.Z.musicLibraryStatusEntity&&u.push(this.Z.musicLibraryStatusEntity);this.Z.primaryArtists&&u.push.apply(u,g.rj(this.Z.primaryArtists));this.Z.details&&u.push(this.Z.details);this.Z.userDetails&&u.push(this.Z.userDetails);this.Z.tracks&&u.push.apply(u,g.rj(this.Z.tracks));this.Z.share&&u.push(this.Z.share);this.Z.downloadMetadata&&u.push(this.Z.downloadMetadata);this.Z.refresh&&u.push(this.Z.refresh);return[].concat(g.rj(new Set(u)))};
g.V(fKx,Zf);fKx.prototype.j=function(){var u=[];this.Z.albumRelease&&u.push(this.Z.albumRelease);this.Z.tracks&&u.push.apply(u,g.rj(this.Z.tracks));return[].concat(g.rj(new Set(u)))};
g.V(DJg,Zf);DJg.prototype.j=function(){var u=[];this.Z.albumRelease&&u.push(this.Z.albumRelease);return[].concat(g.rj(new Set(u)))};
g.V(GON,Zf);GON.prototype.j=function(){var u=[];this.Z.details&&u.push(this.Z.details);this.Z.userDetails&&u.push(this.Z.userDetails);return[].concat(g.rj(new Set(u)))};
g.V(XnW,Zf);XnW.prototype.j=function(){var u=[];this.Z.parentArtist&&u.push(this.Z.parentArtist);return[].concat(g.rj(new Set(u)))};
g.V(mJN,Zf);mJN.prototype.j=function(){var u=[];this.Z.parentArtist&&u.push(this.Z.parentArtist);return[].concat(g.rj(new Set(u)))};
g.V($J2,Zf);$J2.prototype.j=function(){return[]};
g.V(MAb,Zf);MAb.prototype.j=function(){return[]};
g.V(EAW,Bw);EAW.prototype.j=function(){var u=[];this.Z.creatorEntity&&u.push(this.Z.creatorEntity);return[].concat(g.rj(new Set(u)))};
g.V(qih,Zf);
qih.prototype.j=function(){var u=[];this.Z.tracks&&u.push.apply(u,g.rj(this.Z.tracks));this.Z.refresh&&u.push(this.Z.refresh);this.Z.musicLibraryStatusEntity&&u.push(this.Z.musicLibraryStatusEntity);this.Z.details&&u.push(this.Z.details);this.Z.downloadMetadata&&u.push(this.Z.downloadMetadata);this.Z.sideloadMetadata&&u.push(this.Z.sideloadMetadata);this.Z.userDetails&&u.push(this.Z.userDetails);this.Z.entryCollection&&u.push(this.Z.entryCollection);this.Z.share&&u.push(this.Z.share);this.Z.podcastShowAdditionalMetadata&&
u.push.apply(u,g.rj((new EAW(this.Z.podcastShowAdditionalMetadata)).j()));return[].concat(g.rj(new Set(u)))};
g.V(riN,Zf);riN.prototype.j=function(){return[]};
g.V(dJb,Zf);
dJb.prototype.j=function(){var u=[];this.Z.musicLibraryStatusEntity&&u.push(this.Z.musicLibraryStatusEntity);this.Z.artists&&u.push.apply(u,g.rj(this.Z.artists));this.Z.audioModeVersion&&u.push(this.Z.audioModeVersion);this.Z.videoModeVersion&&u.push(this.Z.videoModeVersion);this.Z.userDetails&&u.push(this.Z.userDetails);this.Z.details&&u.push(this.Z.details);this.Z.albumRelease&&u.push(this.Z.albumRelease);this.Z.share&&u.push(this.Z.share);this.Z.libraryEdit&&u.push(this.Z.libraryEdit);this.Z.downloadMetadata&&
u.push(this.Z.downloadMetadata);this.Z.playbackPosition&&u.push(this.Z.playbackPosition);this.Z.lyrics&&u.push(this.Z.lyrics);return[].concat(g.rj(new Set(u)))};
g.V(Six,Zf);Six.prototype.j=function(){var u=[];this.Z.parentTrack&&u.push(this.Z.parentTrack);return[].concat(g.rj(new Set(u)))};
g.V(CDH,Zf);CDH.prototype.j=function(){var u=[];this.Z.parentTrack&&u.push(this.Z.parentTrack);return[].concat(g.rj(new Set(u)))};
g.V(sLN,Zf);sLN.prototype.j=function(){return[]};
g.V(VAd,Zf);VAd.prototype.j=function(){return[]};
g.V(oAy,Zf);oAy.prototype.j=function(){return[]};
g.V(WMT,Zf);WMT.prototype.j=function(){return[]};
g.V(FMg,Zf);FMg.prototype.j=function(){var u=[];this.Z.transfer&&u.push(this.Z.transfer);this.Z.adsPlaybackData&&u.push.apply(u,g.rj(this.Z.adsPlaybackData));this.Z.drmLicense&&u.push(this.Z.drmLicense);this.Z.offlineVideoPolicy&&u.push(this.Z.offlineVideoPolicy);this.Z.videoDownloadContextEntity&&u.push(this.Z.videoDownloadContextEntity);return[].concat(g.rj(new Set(u)))};
g.V(vA3,Zf);vA3.prototype.j=function(){return[]};
g.V(yiy,Zf);yiy.prototype.j=function(){var u=[];this.Z.offlineVideoStreams&&u.push.apply(u,g.rj(this.Z.offlineVideoStreams));this.Z.captionTrack&&u.push.apply(u,g.rj(this.Z.captionTrack));return[].concat(g.rj(new Set(u)))};
g.V(zyv,Zf);zyv.prototype.j=function(){return[]};
g.V(QL2,Zf);QL2.prototype.j=function(){return[]};
g.V(wnZ,Zf);wnZ.prototype.j=function(){return[]};
g.V(JiT,Zf);JiT.prototype.j=function(){return[]};
g.V(HDx,Zf);HDx.prototype.j=function(){return[]};
g.V(kOx,Zf);kOx.prototype.j=function(){return[]};
g.V(cib,Zf);cib.prototype.j=function(){return[]};
g.V(ODh,Zf);ODh.prototype.j=function(){return[]};
g.V(jL3,Zf);jL3.prototype.j=function(){return[]};
g.V(BiH,Zf);BiH.prototype.j=function(){return[]};
g.V(ZDb,Zf);ZDb.prototype.j=function(){return[]};
g.V(LMg,Zf);LMg.prototype.j=function(){return[]};
g.V(Nid,Zf);Nid.prototype.j=function(){return[]};
g.V(Ry2,Zf);Ry2.prototype.j=function(){return[]};
g.V(KMg,Zf);KMg.prototype.j=function(){return[]};
g.V(UJx,Zf);UJx.prototype.j=function(){return[]};
g.V(Yi3,Zf);Yi3.prototype.j=function(){return[]};
g.V(hy2,Zf);hy2.prototype.j=function(){return[]};
g.V(bDW,Zf);bDW.prototype.j=function(){return[]};
g.V(aKb,Zf);aKb.prototype.j=function(){return[]};
g.V(gAx,Zf);gAx.prototype.j=function(){return[]};
g.V(IKZ,Zf);IKZ.prototype.j=function(){return[]};
var g3b=["browse","music/browse","unplugged/browse"],PPv=["offline/playlist_sync_check"],Lcy=["offline"],I12=["offline/offline_video_playback_position_sync"],T8x=["offline/get_playback_data_entity"],LH;Ns.getInstance=function(){return g.O(function(u){return u.return(new Promise(function(l){g.bm().then(function(e){e?(Ns.instance||(Ns.instance=new Ns(e)),l(Ns.instance)):l(void 0)})}))})};
Ns.prototype.get=function(u){var l=this,e,p,x;return g.O(function(f){if(f.Z==1)return g.c(f,PDx(l.token),2);if(f.Z!=3)return e=f.j,g.c(f,e.get("prefs",u),3);p=f.j;if(!p)return f.return();x=(0,g.so)();return p.expirationTimestampMs<=x?f.return():f.return(p.value)})};
Ns.prototype.set=function(u,l,e){e=e===void 0?31536E3:e;var p=this,x,f,D;return g.O(function(X){if(X.Z==1)return x=(0,g.so)(),f={key:u,value:l,expirationTimestampMs:x+e*1E3},g.c(X,PDx(p.token),2);D=X.j;return g.c(X,g.zV(D,"prefs",f),0)})};
Ns.prototype.remove=function(u){var l=this,e;return g.O(function(p){if(p.Z==1)return g.c(p,PDx(l.token),2);e=p.j;return g.c(p,e.delete("prefs",u),0)})};
g.V(Ro,g.UJ);g.V(KH,eWg);KH.prototype.J=function(u,l){l=xO2(l);u=(new TextEncoder).encode(JSON.stringify(u));return this.Z.encrypt(u,l)};
KH.prototype.j=function(u,l){if(!(u instanceof Uint8Array))throw AiH(1);var e=new TextDecoder;l=xO2(l);u=this.Z.decrypt(u,l);return JSON.parse(e.decode(u))};
var fih={accountLinkStatusEntity:duh,booleanEntity:Dux,buttonEntity:KMg,captionTrack:sLN,channelHandle:plx,chipEntity:cib,commerceAcquisitionClientPayloadEntity:Yi3,commerceCartListEntity:hy2,compositeSourceEntity:Atb,multiviewStagingEntity:uwb,contextNoteFeedEntityPayload:xux,contextNoteUserRatingEntityPayload:fjx,continuationTokenEntity:kqb,downloadQualityPickerEntity:V7d,downloadsPageRefreshTokenEntity:WFd,downloadsPageViewConfigurationEntity:KFH,downloadStatusEntity:o23,dismissState:ODh,sfvAudioItemCurrentlyPlayingEntity:JiT,
emojiFountainDataEntity:Nid,emojiCustomizationSetEntity:LMg,fakeChannel:Xlg,fakePlaylist:muW,fakePlaylistEntryCollection:M7y,fakeVideo:E2b,fakeVideoDescription:q9v,featuredProductsEntity:TPb,flowStateEntity:rtb,iconBadgeEntity:bDW,interstitialInteractionStateEntity:CVT,likeButtonAnimationEntity:Uux,liveChatPollStateEntity:skg,dataFreshnessEntity:ZDb,liveViewerLeaderboardChatEntryPointStateEntity:QL2,liveViewerLeaderboardPointsEntity:wnZ,liveReactionsDataEntity:Ry2,logoEntity:S9N,macroMarkerEntity:Y9d,
mainDownloadsLibraryEntity:FFx,mainDownloadsListEntity:ytx,mainPlaylistDownloadStateEntity:zdb,mainPlaylistEntity:ctT,mainPlaylistVideoEntity:Odv,mainVideoDownloadStateEntity:QkN,mainVideoEntity:LFx,markersEngagementPanelSyncEntity:hdv,markersVisibilityOverrideEntity:bd3,musicAlbumReleaseDetail:fKx,musicAlbumReleaseDownloadMetadataEntity:iDd,musicAlbumRelease:xJN,musicAlbumReleaseUserDetail:DJg,musicArtistDetail:XnW,musicArtist:GON,musicArtistUserDetail:mJN,musicDownloadsLibraryEntity:lKH,musicLibraryEdit:$J2,
musicLibraryStatusEntity:MAb,musicPlaylist:qih,musicPlaylistDownloadMetadataEntity:ey3,musicShare:riN,musicTrackDetail:Six,musicTrackDownloadMetadataEntity:pnh,musicTrack:dJb,musicTrackUserDetail:CDH,offlineOrchestrationActionWrapperEntity:VAd,offlineVideoPolicy:oAy,offlineVideoStreams:WMT,offlineabilityEntity:wlb,orchestrationWebSamplingEntity:Jt3,pageHeaderEntity:jL3,pdpStateEntity:aKb,pinnedProductEntity:n2g,playbackData:FMg,playerStateEntity:ajb,quantityIncrementerEntity:gAx,refresh:vA3,saveToPlaylistListEntity:HDx,
selectedChipIndexEntityPayload:g23,settingEntity:kOx,stringEntity:Gqb,suggestedFeedbackChipStateEntity:Ij2,transfer:yiy,trendingOfferEntity:PVg,videoDownloadContextEntity:zyv,videoOverviewAsyncDataEntity:IKZ,videoPlaybackPositionEntity:UJx,votingEntity:BiH,ytMainChannelEntity:NPZ,youchatPendingResponseEntity:t7d,ytMainDownloadedVideoEntity:Hdh,ytMainVideoEntity:RdN};g.V(gq,eWg);gq.prototype.J=function(u){return u};
gq.prototype.j=function(u){if(u instanceof Uint8Array)throw AiH(0);return u};
g.V(Io,g.R);Io.prototype.observe=function(u){var l=this;this.observers.push(u);return function(){var e=l.observers.indexOf(u);e>=0&&l.observers.splice(e,1)}};
Io.prototype.j=function(u){Vkg(this,u.data)};
Io.prototype.ip=function(){this.channel.close()};
var yh2,FcN=new g.v0("elementsCommand");var Fq=new g.v0("entityBatchUpdate");var $oy=new g.v0("downloadStatusEntity");var zCg=new g.v0("mainPlaylistEntityActionMetadata");var Tc=new g.v0("mainVideoEntityActionMetadata");var ZTb=new g.v0("musicPlaylistEntityActionMetadata");var DNv=new g.v0("musicTrackEntityActionMetadata");var USx=new g.v0("localImageEntityActionMetadata");var B$=new g.v0("playbackDataActionMetadata");var F_b=new g.v0("transferEntityActionMetadata");var Xsx=new g.v0("videoPlaybackPositionEntityActionMetadata");var KAx;new g.mA;new g.mA;aib.prototype.request=function(u,l,e){l=l===void 0?{}:l;return this.locks.request(u,l,function(p){return e(p)})};var lB=g.Pk.caches,iB,noH;uB.prototype.open=function(u){return lB.open(tkv(u))};
uB.prototype.has=function(u){return lB.has(tkv(u))};
uB.prototype.delete=function(u){return lB.delete(tkv(u))};
uB.prototype.match=function(u,l){var e=this,p,x,f,D,X,m;return g.O(function(M){switch(M.Z){case 1:return g.c(M,e.keys(),2);case 2:p=M.j,x=g.F(p),f=x.next();case 3:if(f.done){M.Ke(5);break}D=f.value;return g.c(M,e.open(D),6);case 6:return X=M.j,g.c(M,X.match(u,l),7);case 7:if(m=M.j)return M.return(m);f=x.next();M.Ke(3);break;case 5:return M.return()}})};
g.V(IiN,uB);IiN.prototype.keys=function(){var u,l,e,p,x,f,D,X,m;return g.O(function(M){if(M.Z==1)return u=[],l=g.YC("CacheStorage keys"),g.c(M,lB.keys(),2);e=M.j;p=g.F(e);for(x=p.next();!x.done;x=p.next()){f=x.value;var E=f.indexOf(":");D=E===-1?{oA:f}:{oA:f.substring(0,E),datasyncId:f.substring(E+1)};X=D.oA;m=D.datasyncId;m===l&&u.push(X)}return M.return(u)})};g.V(pB,g.R);pB.prototype.J=function(u){this.api.Nj("onOfflineOperationFailure",u.data)};
pB.prototype.X=function(u){this.api.publish("offlinetransferpause",u.data)};
pB.prototype.ip=function(){var u;(u=this.Z)==null||u.close();var l;(l=this.j)==null||l.close()};ulW.prototype.I$=function(){this.Z&&fB(this)};
ulW.prototype.zV=function(){this.j&&this.j.resolve();this.J=this.Z=!1;this.Y()};var Ruy=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var V0b="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var ksx="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.V(uuN,kG);uuN.prototype.j=function(u){return mR(u)?euZ(this,u):$G(u)?fMv(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};g.V(DjZ,kG);DjZ.prototype.j=function(u){return $G(u)?GQN(this,u):moW(u)?mjy(this,u):M1(u)?$jT(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};g.C=Mtv.prototype;g.C.dLZ=function(u){var l=this,e,p,x,f;return g.O(function(D){if(!g.t(u.state,128))return D.Ke(0);e=u.state.Sl;var X=(p=e)==null?void 0:p.errorCode,m=(x=e)==null?void 0:x.z8;f=X==="net.connect"&&m===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(X==null?0:X.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.c(D,l.Hw(l.player.getVideoData().videoId,f),0)})};
g.C.Hw=function(u,l){var e=this;return g.O(function(p){if(p.Z==1){if(e.j)return p.return();e.j=!0;return l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(N1(e,u,!1,!0),p.Ke(0)):g.c(p,LB(e,u),3)}g.GA(u,4);return g.c(p,e.Z.Hw(l),0)})};
g.C.h3=function(u){u.status===2?(u.status!==this.J&&(DSx(this.Z),g.GA(u.videoId,2)),u.cj&&MFh(this.Z,u.videoId,u.cj)):u.status===4?(LB(this,u.videoId),this.Hw(u.videoId,u.wV?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):u.status===1&&$SW(this.Z);this.J=u.status;this.api.Nj("localmediachange",{videoId:u.videoId,status:u.status})};
g.C.u4=function(){var u=this,l;return g.O(function(e){if(e.Z==1){if(u.j)return e.return();u.j=!0;l=u.player.getVideoData().videoId;return g.c(e,LB(u,l),2)}return g.c(e,u.Z.u4(),0)})};
g.C.g2=function(u){switch(u){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.C.W=function(u){return this.api.S().W(u)};g.V(C1T,kG);C1T.prototype.j=function(u){return mR(u)?Vtx(this,u):$G(u)?oXx(this,u):moW(u)?W_W(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};ws2.prototype.Z=function(u,l){var e=u.action.actionMetadata.priority-l.action.actionMetadata.priority;e===0&&(u.Z<l.Z?e=-1:u.Z>l.Z&&(e=1));return e};g.V(RS,g.R);RS.prototype.ip=function(){this.Y&&this.Y();g.R.prototype.ip.call(this)};
RS.prototype.createAction=function(u,l){var e=g.PD(u.entityKey).entityType,p=g.Mv(16);return new Sa(e,p,u,l.actionId,l.rootActionId)};
RS.prototype.F9=function(u){var l=this,e,p,x,f,D,X,m,M,E;return g.O(function(q){if(q.Z==1){if(l.xg())return q.return();p=(e=u.offlineOrchestrationActionWrapperEntity)!=null?e:new Set;x=[];f=g.F(p);for(D=f.next();!D.done;D=f.next())X=D.value,m=g.PD(X),M=m.entityId,kQg(l.Z,M)||x.push(X);return g.c(q,Y8Z(l,x),2)}E=q.j;return g.c(q,Ujg(l,E),0)})};
RS.prototype.retry=function(){var u=this;return g.O(function(l){return g.c(l,hug(u),0)})};aMb.prototype.u9=function(u,l){l=l===void 0?!0:l;var e=this,p,x,f,D,X,m,M,E;return g.O(function(q){switch(q.Z){case 1:if(!e.Z)return q.return();p=[];x=g.ii(e.Z.j,l);f=[];for(D={gm:0};D.gm<x.length;D={gm:D.gm},D.gm++)X=x[D.gm],m=e.Z.V4(X,"json3"),M=g.QC(m,{withCredentials:!0,format:"RAW"},3,500).then(function(r){return function(d){d={metadata:g.gB(x[r.gm]),trackData:d.xhr.responseText};f.push(d)}}(D)).J4(function(r){ea("Caption fetch error",r)}),p.push(M);
return g.c(q,edd(p),2);case 2:return g.vk(q,3),g.c(q,Obv(u,f),5);case 5:g.JK(q,0);break;case 3:E=g.Hk(q),ea("Caption DB transaction error",E),g.F1(q)}})};g.V(KB,g.R);KB.prototype.ip=function(){this.j&&this.j();g.R.prototype.ip.call(this)};
KB.prototype.J=function(u){var l=this,e,p,x,f,D,X,m,M;return g.O(function(E){p=(e=u.transfer)!=null?e:new Set;x=[];f=g.F(p);for(D=f.next();!D.done;D=f.next())X=D.value,m=g.PD(X),M=m.entityId,x.push(M);return x.length===0?E.return():g.c(E,ttg(l,x),0)})};g.V(ueW,g.R);g.C=ueW.prototype;g.C.ip=function(){this.JZ&&this.JZ();this.Rs.dispose();this.X.dispose();this.P7&&g.Tq(this.B.oV,this.P7);this.AZ&&g.Tq(this.B.oV,this.AZ);g.R.prototype.ip.call(this)};
g.C.XFe=function(u){var l=this,e,p,x;return g.O(function(f){switch(f.Z){case 1:e=g.Ac(u,"transfer");if(l.Z&&e===l.Z.key){N1(l.C,l.K,!0);l.X.stop();f.Ke(0);break}return g.c(f,t_(l.j,{mode:"readwrite",yH:!0},function(D){return UP(D,e,"transfer").then(function(X){if(X&&X.transferState!=="TRANSFER_STATE_COMPLETE"&&X.transferState!=="TRANSFER_STATE_FAILED")return X.transferState="TRANSFER_STATE_PAUSED_BY_USER",bg(D,X,"transfer").then(function(){return X})})}),3);
case 3:p=f.j;if(!p){f.Ke(0);break}if(!u||!l.J){f.Ke(5);break}return g.c(f,E6(u,l.J,l.j,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.c(f,hV(l,u),7);case 7:x=f.j,Gsb({videoId:u,qO:p,offlineModeType:x}),g.F1(f)}})};
g.C.Jup=function(){var u=this;if(this.Z&&this.K){N1(this.C,this.K,!1);var l=this.Z,e=(l==null?0:l.key)?g.PD(l.key).entityId:"";e&&this.J&&(new Promise(function(p,x){E6(e,u.J,u.j,"DOWNLOAD_STATE_PAUSED").catch(function(f){x(f)})})).catch(function(p){ea("Download state setting error",p)})}this.X.stop()};
g.C.jo=function(){this.Z?eCb(this,this.Z):YG(this)};
g.C.Ph=function(u){var l=this;return g.O(function(e){switch(e.Z){case 1:if(!l.Z){e.Ke(2);break}if(l.Z.transferState==="TRANSFER_STATE_COMPLETE"||l.Z.transferState==="TRANSFER_STATE_FAILED"||!u.transfer||!u.transfer.has(l.Z.key)){e.Ke(3);break}return g.c(e,nH(l.j,l.Z.key,"transfer"),4);case 4:l.Z=e.j;if(l.Z){e.Ke(3);break}return g.c(e,p0N(l),3);case 3:if(l.Z)return e.return();case 2:return g.c(e,YG(l),0)}})};
g.C.Hw=function(u,l){var e=this,p,x,f,D,X;return g.O(function(m){switch(m.Z){case 1:if(!e.Z){bB(e,"onTransferFailure: "+u);m.Ke(2);break}p=e.Z;f=((x=p)==null?0:x.key)?g.PD(p.key).entityId:"";a:switch(u){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var M=!1;break a;default:M=!0}return M&&E_b(e)?g.c(m,aS(e,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.c(m,
qEh(e,u),5);case 5:if(!f||!e.J){m.Ke(2);break}return g.c(m,E6(f,e.J,e.j,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.c(m,hV(e,f),9);case 9:D=m.j;Gc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:f,qO:p,offlineModeType:D});if(!f||!e.J){m.Ke(2);break}return g.c(m,E6(f,e.J,e.j,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:U6(e),X=YG(e,!0),l&&l(X),g.F1(m)}})};
g.C.u4=function(u){var l=this,e,p,x,f,D,X,m,M,E,q,r,d;return g.O(function(S){switch(S.Z){case 1:if(!l.Z){bB(l,"onMaybeTransferStreamsExpired");S.Ke(2);break}return E_b(l)?g.c(S,aS(l,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.c(S,qEh(l,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!l.J){S.Ke(2);break}e=l.Z;x=((p=e)==null?0:p.key)?g.PD(e.key).entityId:"";if(!x){S.Ke(2);break}return g.c(S,E6(x,l.J,l.j,"DOWNLOAD_STATE_FAILED"),2);case 9:return l.Z||bB(l,"onMaybeTransferStreamsExpiredRetryAttempting"),
f=l.Z,X=((D=f)==null?0:D.key)?g.PD(f.key).entityId:"",g.c(S,hV(l,X),10);case 10:return m=S.j,Gc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:X,qO:f,offlineModeType:m}),M=qB2(),g.cx(M,B$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),E=g.Ac(X,"playbackData"),q={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:E,actionMetadata:M},r=s6(new Sa("playbackData",X,q)),g.c(S,TF(l.j,r,"offlineOrchestrationActionWrapperEntity"),2);case 2:U6(l),d=YG(l,!0),
u&&u(d),g.F1(S)}})};
var C_v={},rDT=(C_v.TRANSFER_STATE_TRANSFERRING=1,C_v.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,C_v);g.C=g7.prototype;g.C.OS=function(){return this.K.promise};
g.C.pT=function(){if(this.j&&this.C)return this.K.promise;CJ2(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.C.oN=function(u){var l={};return l.playbackData=new uuN(u,this.Qo,this.Z),l.transfer=new C1T(u,this.Qo),l.videoPlaybackPositionEntity=new DjZ(u,this.Qo),l};
g.C.zP=function(){var u=this;return g.O(function(l){return u.j?g.c(l,i_N(u.j),0):l.Ke(0)})};
g.C.IP=function(){var u=this,l,e;return g.O(function(p){if(p.Z==1)return u.j||u.C?g.c(p,u.OS(),2):p.return();u.G!==void 0&&(g.d3(u.G),u.G=void 0);u.X!==void 0&&(g.d3(u.X),u.X=void 0);(l=u.j)==null||l.dispose();u.j=void 0;(e=u.C)==null||e.dispose();u.C=void 0;u.api.Nj("onOrchestrationLostLeader");u.K=new g.mA;g.F1(p)})};
g.C.isOrchestrationLeader=function(){return this.J.Z};
g.C.PK=function(){return g.O(function(u){return u.return(!1)})};
g.C.AB=function(u){var l=this.Z;l.api.publish("offlinetransferpause",u);var e;(e=l.j)==null||e.postMessage(u)};
g.C.jo=function(u){var l,e;return g.O(function(p){if(p.Z==1)return g.c(p,A_(),2);l=p.j;if(!l)return p.return();e=g.Ac(u,"transfer");return g.c(p,t_(l,{mode:"readwrite",yH:!0},function(x){var f=UP(x,e,"transfer"),D=UP(x,g.Ac(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.rC.all([f,D]).then(function(X){X=g.F(X);var m=X.next().value;var M=X.next().value;return m&&m.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(m.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",bg(x,m,"transfer").then(function(){Gc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:u,qO:m,offlineModeType:M==null?void 0:M.offlineModeType});return g.rC.resolve(null)})):g.rC.resolve(null)})}),0)})};
g.C.uv=function(u){u=u===void 0?43200:u;var l=this,e,p,x,f,D,X,m,M;return g.O(function(E){if(E.Z==1)return l.B.OG()?g.c(E,A_(),2):E.return(sVT());if(E.Z!=3){e=E.j;if(!e)return E.return([]);p=Date.now()/1E3;return g.c(E,Pw(e,"offlineVideoPolicy"),3)}x=E.j;f=[];D=g.F(x);for(X=D.next();!X.done;X=D.next())m=X.value,Number(m.lastUpdatedTimestampSeconds)+u<=p&&(M=g.PD(m.key).entityId,f.push(M));return f.length?E.return(IS(l,f,l.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):E.return([])})};
g.C.deleteAll=function(){return IS(this,["!*$_ALL_ENTITIES_!*$"],this.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.C.refreshAllStaleEntities=function(u){var l=this;return g.O(function(e){return e.Z==1?g.c(e,l.uv(u),2):e.return(e.j)})};
g.C.setUpPositionSyncInterval=function(u){var l=this;this.X!==void 0&&(g.d3(this.X),this.X=void 0);var e=u!=null?u:864E5;this.X=g.qN(function(){l.If(e)},e)};
g.C.If=function(u){var l=this,e,p,x,f,D,X;return g.O(function(m){switch(m.Z){case 1:return g.vk(m,2),g.c(m,Ns.getInstance(),4);case 4:e=m.j;if(!e)throw Error("prefStorage is undefined");return g.c(m,e.get("psi"),5);case 5:p=m.j;f=((x=p)==null?0:x.IU)?Number(p.IU)/1E3:0;D=Date.now();if(!(f+u<=D)){m.Ke(6);break}return g.c(m,IS(l,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.JK(m,0);break;case 2:X=g.Hk(m),ea("Offline manager error",X),
g.F1(m)}})};
g.C.F$=function(){var u=this,l,e,p,x,f,D,X;return g.O(function(m){if(m.Z==1)return g.c(m,A_(),2);if(m.Z!=3)return(l=m.j)?g.c(m,Pw(l,"transfer"),3):m.return([]);e=m.j;p=[];x=g.F(e);for(f=x.next();!f.done;f=x.next())D=f.value,D.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&D.key&&(X=g.PD(D.key).entityId,p.push(X));return m.return(o_x(u,p))})};
g.C.jY=function(){return g.O(function(u){return u.return([])})};
g.C.FY=function(){return g.O(function(u){g.F1(u)})};
g.C.gH=function(){return g.O(function(u){g.F1(u)})};g.V(W$3,kG);W$3.prototype.j=function(u){return mR(u)?yDy(this,u):$G(u)?QVx(this,u):M1(u)?w0N(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};
var tV=[10];g.V(O_H,kG);O_H.prototype.j=function(u){return mR(u)?Z_W(this,u):$G(u)?L$Z(this,u):M1(u)?NYZ(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};
var BYx=[10];g.V(K$3,kG);K$3.prototype.j=function(u){return $G(u)?YE3(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};g.V(hCh,g7);g.C=hCh.prototype;g.C.oN=function(u){var l=g7.prototype.oN.call(this,u);l.mainVideoEntity=new O_H(u,this.Qo,this.Z);l.mainPlaylistEntity=new W$3(u,this.Qo,this.Z);l.mainDownloadsListEntity=new K$3(u,this.Qo,this.Z);return l};
g.C.refreshAllStaleEntities=function(u,l){var e=this,p,x,f,D,X,m,M,E,q,r,d;return g.O(function(S){switch(S.Z){case 1:p=[];if(!e.Qo.W("web_player_offline_playlist_auto_refresh")){S.Ke(2);break}return g.c(S,b_W(e,u,l),3);case 3:p=S.j;case 2:return g.c(S,Ns.getInstance(),4);case 4:return x=S.j,g.c(S,(f=x)==null?void 0:f.get("sdois"),5);case 5:return D=S.j,g.c(S,(X=x)==null?void 0:X.get("lmqf"),6);case 6:m=S.j;if(!D){S.Ke(7);break}E=p;q=E.concat;return g.c(S,a0g(e,D,(M=m)!=null?M:"SD",u===0),8);case 8:p=
q.call(E,S.j);case 7:return r=p,d=r.concat,g.c(S,g7.prototype.refreshAllStaleEntities.call(e,u,l),9);case 9:return p=d.call(r,S.j),S.return(p)}})};
g.C.PK=function(u){var l,e,p,x,f,D,X,m;return g.O(function(M){if(M.Z==1)return g.c(M,A_(),2);if(M.Z!=3)return(l=M.j)?g.c(M,nH(l,g.jj,"mainDownloadsListEntity"),3):M.return(!1);e=M.j;if((p=e)==null?0:(x=p.downloads)==null?0:x.length)for(f=g.Ac(u,"mainVideoEntity"),D=g.F(e.downloads),X=D.next();!X.done;X=D.next())if(m=X.value,m.videoItem===f)return M.return(!0);return M.return(!1)})};
g.C.jY=function(){var u=this,l,e,p,x,f,D,X,m;return g.O(function(M){if(M.Z==1)return g.c(M,A_(),2);if(M.Z!=3)return(l=M.j)?g.c(M,Pw(l,"downloadStatusEntity"),3):M.return([]);e=M.j;p=[];x=g.F(e);for(f=x.next();!f.done;f=x.next())D=f.value,D.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&D.key&&(X=g.PD(D.key).entityId,p.push(X));return p.length?(m={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},M.return(IS(u,p,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
m))):M.return([])})};
g.C.gH=function(){var u;return g.O(function(l){return l.Z==1?g.c(l,A_(),2):(u=l.j)?g.c(l,t_(u,{mode:"readwrite",yH:!0},function(e){return Yd(e,"mainVideoEntity").then(function(p){var x=[];p=g.F(p);for(var f=p.next();!f.done;f=p.next()){f=f.value;var D=void 0;(D=f.userState)!=null&&D.playbackPosition||(D=g.PD(f.key).entityId,D={key:g.Ac(D,"videoPlaybackPositionEntity"),videoId:D,lastPlaybackPositionSeconds:"0"},x.push(bg(e,D,"videoPlaybackPositionEntity")),f.userState={playbackPosition:D.key},x.push(bg(e,
f,"mainVideoEntity")))}return g.rC.all(x)})}),0):l.return()})};
g.C.FY=function(){var u,l,e,p,x,f,D,X,m,M,E,q,r,d,S,v,z,H,J,B,N,U,n,b,pm,mO,xz,Em,ir,oP,tK,$Z,md,RP,ck,lE,Og,Ug;return g.O(function(Dc){if(Dc.Z==1)return g.c(Dc,A_(),2);if(Dc.Z!=3){u=Dc.j;if(!u)return Dc.return();l=g.Ac("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.c(Dc,t_(u,{mode:"readonly",yH:!0},function(k){return g.rC.all([UP(k,l,"mainDownloadsListEntity"),UP(k,g.jj,"mainDownloadsListEntity"),Yd(k,"mainVideoEntity"),Yd(k,"mainPlaylistEntity")])}),3)}e=Dc.j;
p=g.F(e);x=p.next().value;f=p.next().value;D=p.next().value;X=p.next().value;m=x;M=f;E=D;q=X;r=new Set;if((d=m)==null?0:(S=d.downloads)==null?0:S.length)for(v=g.F(m.downloads),z=v.next();!z.done;z=v.next())H=z.value,J=void 0,(B=(J=H.videoItem)!=null?J:H.playlistItem)&&r.add(B);if((N=M)==null?0:(U=N.downloads)==null?0:U.length)for(n=g.F(M.downloads),b=n.next();!b.done;b=n.next())pm=b.value,pm.videoItem&&r.add(pm.videoItem);mO=new Set;xz=[];Em=g.F(q);for(ir=Em.next();!ir.done;ir=Em.next()){oP=ir.value;
if(oP.videos)for(tK=g.F(oP.videos),$Z=tK.next();!$Z.done;$Z=tK.next())md=$Z.value,(RP=JSON.parse(g.PD(md).entityId).videoId)&&mO.add(RP);oP.key&&!r.has(oP.key)&&xz.push(oP.key)}ck=g.F(E);for(lE=ck.next();!lE.done;lE=ck.next())Og=lE.value,Og.key&&!r.has(Og.key)&&(Ug=g.PD(Og.key).entityId,mO.has(Ug)||xz.push(Og.key));return xz.length?g.c(Dc,QAb(u,xz),0):Dc.Ke(0)})};g.V(g_x,kG);g_x.prototype.j=function(u){return mR(u)?tFh(this,u):$G(u)?TY2(this,u):M1(u)?n_3(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};
var nB=[10];g.V(ADW,kG);ADW.prototype.j=function(u){return mR(u)?i6x(this,u):$G(u)?lsy(this,u):M1(u)?eGh(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};
var P$=[10];g.V(fsg,kG);fsg.prototype.j=function(u){return mR(u)?mNH(this,u):$G(u)?$N3(this,u):M1(u)?MLN(this,u):Promise.reject(Error("Unsupported action type: "+u.actionType))};
var XVv=[10];g.V(AV,g7);AV.prototype.oN=function(u){var l=g7.prototype.oN.call(this,u);l.musicTrack=new fsg(u,this.Z);l.musicPlaylist=new ADW(u,this.Z);l.musicAlbumRelease=new g_x(u,this.Z);return l};
AV.prototype.refreshAllStaleEntities=function(u,l){var e=this,p,x,f;return g.O(function(D){if(D.Z==1)return g.c(D,qex(e,u,l),2);if(D.Z!=3)return x=p=D.j,f=x.concat,g.c(D,g7.prototype.refreshAllStaleEntities.call(e,u,l),3);p=f.call(x,D.j);return D.return(p)})};g.V(rCd,g.Wb);g.C=rCd.prototype;g.C.create=function(){var u=this;g.K(this,this.events);if(g.z1(this.Qo))this.Z=new hCh(this.Qo,this.player);else if(g.BJ(this.Qo)||g.wB(this.Qo))this.Z=new AV(this.Qo,this.player);this.events.L(this.player,"onPlaybackStartExternal",function(){u.fL()});
this.events.L(this.player,"videodatachange",function(){u.fL()});
this.Qo.W("html5_offline_playback_position_sync")&&this.events.L(this.player,"presentingplayerstatechange",this.aU)};
g.C.k6=function(){return!1};
g.C.e3=function(u,l,e,p){var x=this;return g.O(function(f){return x.Z?f.return(IS(x.Z,u,l,e,p)):f.return(Promise.reject())})};
g.C.deleteAll=function(){return this.Z.deleteAll()};
g.C.uv=function(u){return this.Z.uv(u)};
g.C.refreshAllStaleEntities=function(u){return this.Z.refreshAllStaleEntities(u)};
g.C.setUpPositionSyncInterval=function(u){this.Z.setUpPositionSyncInterval(u)};
g.C.AB=function(u){this.Z.AB(u)};
g.C.jo=function(u){return this.Z.jo(u)};
g.C.fL=function(){var u=this,l;return g.O(function(e){l=u.player.getVideoData();return g.WQ(l)?dNx(l)&&u.j!==l.clientPlaybackNonce?g.c(e,Sev(u,l),0):e.Ke(0):e.return()})};
g.C.aU=function(u){var l=this,e,p,x,f,D,X,m;return g.O(function(M){if(M.Z==1)return e=l.player.getVideoData(),p=e.xO,g.Ef(u,2)||g.Ef(u,512)?g.c(M,A_(),2):M.return();if(M.Z!=3){x=M.j;if(!x)return ea("PES is undefined"),M.return();f=e.videoId;return g.c(M,nH(x,g.Ac(f,"mainVideoEntity"),"mainVideoEntity"),3)}D=M.j;if(!D)return M.return();X=Math.floor(p).toString();m={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:X}};return g.c(M,l.e3([f],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
m),0)})};
g.C.isOrchestrationLeader=function(){return this.Z.isOrchestrationLeader()};
g.C.updateDownloadState=function(u,l){var e,p,x,f;return g.O(function(D){if(D.Z==1)return g.c(D,A_(),2);e=D.j;if(!e)return ea("PES is undefined"),D.return();p=g.PD(u);x=p.entityType;f=p.entityId;return g.c(D,E6(f,x,e,l,!0),0)})};g.on("offline",rCd);})(_yt_player);
